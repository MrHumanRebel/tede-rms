{% extends "assets/template.twig" %}
{% block htmlIncludes %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.css" integrity="sha256-VVbO1uqtov1mU6f9qu/q+MfDmrqTfoba0rAE07szS20=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-daterangepicker/3.0.5/daterangepicker.min.js" integrity="sha256-zI6VVO07NPmVW11q3RQE42YbRmJIkkunrcQ9LEYxJsQ=" crossorigin="anonymous"></script>
    <style>

        .text-sm {
            font-size: .975rem !important;
        }

        .google-maps-btn,
        .waze-btn {
            margin-top: 15px;
            margin-bottom: 5px;
            width: 30px; /* Gomb sz√©less√©ge */
            height: 30px; /* Gomb magass√°ga */
            border-radius: 50%; /* Kerek gomb */
            display: inline-flex; /* Egym√°s mell√© helyez√©s */
            justify-content: center;
            align-items: center;
            margin-right: 10px;
        }

        .google-maps-btn i,
        .waze-btn i {
            font-size: 24px; /* Ikon m√©rete */
            color: #fff; /* Feh√©r ikon */
        }

        .google-maps-btn {
            background-color: #7AC142; /* Waze z√∂ld */
            
        }

        .waze-btn {
            background-color: #4285F4; /* Google Maps k√©k */
        }

        #duration {
            margin-bottom: 20px;
        }


        .color-palette {
            height: 35px;
            line-height: 35px;
            text-align: right;
            padding-right: .75rem;
        }

        .color-palette.disabled {
            text-align: center;
            padding-right: 0;
            display: block;
        }

        .color-palette-set {
            margin-bottom: 15px;
        }

        .color-palette span {
            display: none;
            font-size: 12px;
        }

        .color-palette:hover span {
            display: block;
        }

        .color-palette.disabled span {
            display: block;
            text-align: left;
            padding-left: .75rem;
        }

        .color-palette-box h4 {
            position: absolute;
            left: 1.25rem;
            margin-top: .75rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            display: block;
            z-index: 7;
        }

        /* Remove bottom margin from comment cards */
        .timeline-body > p {
            margin-bottom: 0;
        }
    </style>

    <!--Summernote-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-bs4.css" integrity="sha256-CLMYHViXNCxDUd/ySLeJJjyLtteBZwjqZ4c5p6U7L78=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote-bs4.min.js" integrity="sha256-jPK1ABk4CuFvSr31v4CLU7X7XCvixZSi8fTTCw/tsto=" crossorigin="anonymous"></script>

    <!--Sortable-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" integrity="sha256-KM512VNnjElC30ehFwehXjx1YCHPiQkOPmqnrWtpccM=" crossorigin="anonymous"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
        $.widget.bridge('uibutton', $.ui.button)
    </script>
    <!--Sweet Alert-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert2/8.19.1/sweetalert2.min.js" integrity="sha512-wKdazFGbrow0TxFpymoSlXoqpHt9SOXw94CYLZV+BTCbk6RH67FuaVTjMo2/rs0doYWEy8mdGbk0/mSSUOJG7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet"  href="{{ CONFIG.ROOTURL }}/static-assets/libs/sweetalert2/sweetAlert2-bootstrap-4.min.css" />
{% endblock %}
{% block content %}
    <div class="row">
        <div class="col-12 col-md-12 col-lg-12">
            <div class="row">
                {% if project.projectsTypes_config_assets == 1 %}
                    {% for assetAssignment in FINANCIALS.assetsAssigned %}
                        {% for flag in assetAssignment.flagsblocks.BLOCK %}
                            <div class="alert alert-danger">
                                <a href="{{ CONFIG.ROOTURL }}/maintenance/job.php?id={{ flag.maintenanceJobs_id }}" type="button" style="text-decoration: none;" class="close"><i class="fas fa-info-circle"></i></a>
                                <h5> <i class="fas fa-ban"></i> {{ assetAssignment.assets_tag|aTag }}: {{ assetAssignment.manufacturers_name }} - {{ assetAssignment.assetTypes_name }}</h5>
                                {{ flag.maintenanceJobs_title }} - {{ flag.maintenanceJobs_faultDescription }}
                            </div>
                        {% endfor %}
                    {% endfor %}
                    {% if project.projectsStatuses_assetsReleased == 1 %}
                    <div class="col-12">
                        <div class="alert alert-danger">
                            <h5><i class="fas fa-exclamation-triangle"></i> Az eszk√∂z√∂k nincsenek lefoglalva</h5>
                            Ehhez a projekthez rendelt eszk√∂z√∂k m√°s projektekhez is rendelhet≈ëk, amelyek √ºtk√∂zhetnek ezzel, mivel a projekt m√©g vagy m√°r nem akt√≠v.
                        </div>
                    </div>
                    {% endif %}
                {% endif %}
                {# Nav Bar for page views #}
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-pills" id="nav-bar">
                                <li class="nav-item"><a class="nav-link active" href="#details-view" data-toggle="tab" style="font-weight:bold;">{{project.projects_name}}</a></li>
                                {% if project.projectsTypes_config_assets == 1 and project.projects_dates_deliver_start and project.projects_archived != 1 and "PROJECTS:PROJECT_ASSETS:CREATE:ASSIGN_AND_UNASSIGN"|instancePermissions %}
                                    <li class="nav-item"><a class="nav-link" href="{{CONFIG.ROOTURL}}/assets.php?project={{project.projects_id}}&project_referer={{project.projects_id}}"><i class="fas fa-plus"></i> Eszk√∂z√∂k hozz√°ad√°sa</a></li>
                                {% endif %}
                                {% if (FINANCIALS['assetsAssigned'] or FINANCIALS['assetsAssignedSUB']) and project.projectsTypes_config_assets == 1 %}
                                    <li class="nav-item"><a class="nav-link" href="#assets-view" data-toggle="tab"><i class="fas fa-list"></i> Eszk√∂z√∂k list√°ja</a></li>
                                    {#<li class="nav-item"><a class="nav-link" href="#assets-board" data-toggle="tab"><i class="fas fa-shipping-fast"></i> Eszk√∂z√∂k kisz√°ll√≠t√°sa</a></li>#}
                                {% endif %}
                                <li class="nav-item">
                                    <a class="nav-link" href="#file-view" data-toggle="tab">
                                        <i class="fas fa-file-alt"></i>
                                        {% if CONFIG.FILES_ENABLED == "Enabled" and USERDATA.instance.instances_storageEnabled == 1 and project.projectsTypes_config_files == 1 %}
                                            F√°jlok
                                        {% endif %}
                                    </a>
                                </li>
                                {% if "PROJECTS:PROJECT_PAYMENTS:VIEW"|instancePermissions and project.projectsTypes_config_finance == 1 %}
                                    <li class="nav-item"><a class="nav-link" href="#payments-view" data-toggle="tab"><i class="fas fa-pound-sign"></i> P√©nz√ºgyek</a></li>
                                {% endif %}
                                {% if "PROJECTS:PROJECT_CREW:VIEW"|instancePermissions and project.projectsTypes_config_crew == 1 %}
                                    <li class="nav-item"><a class="nav-link" href="#crew-view" data-toggle="tab"><i class="fas fa-users"></i> Csapat</a></li>
                                {% endif %}
                                {% if project.subProjects %}
                                    <li class="nav-item"><a class="nav-link" href="#calendar-view" data-toggle="tab"><i class="fas fa-calendar-alt"></i> Alprojektek</a></li>
                                {% endif %}
                                {% if project.auditLog|length > 0 %}
                                <li class="nav-item"><a class="nav-link" href="#log-view" data-toggle="tab"><i class="fas fa-comments"></i>  El≈ëzm√©nyek</a></li>
                                {% endif %}
                            </ul>
                        </div>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane active" id="details-view">
                            <div class="row">
                                <div class="col-lg-4 col-md-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h3 class="card-title">{{ project.projectsTypes_name }}</h3>
                                            <div class="card-tools">
                                                {#
                                                {% if project.projectsTypes_config_assets == 1 and project.projects_dates_deliver_start and project.projects_archived != 1 and "PROJECTS:PROJECT_ASSETS:CREATE:ASSIGN_ALL_BUSINESS_ASSETS"|instancePermissions %}
                                                    <button type="button" class="btn btn-tool" title="Minden eszk√∂z hozz√°ad√°sa a projekthez" id="addAllAssetsToProject"><i class="fas fa-dolly"></i></button>
                                                {% endif %}
                                                #}
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div class="row">
                                                <style>
                                                    #projectDetailBox p {
                                                        margin-bottom: 6px;
                                                        margin-top: 4px;
                                                    }
                                                </style>
                                                <div class="col-12" id="projectDetailBox">
                                                    {% if project.projects_archived == 1 %}
                                                        <div class="alert alert-danger">
                                                            <h5><i class="icon fas fa-ban"></i> Arch√≠v√°lva</h5>
                                                            Ez a projekt archiv√°l√°sra ker√ºlt.
                                                        </div>
                                                    {% endif %}
                                                    <h3 class="text-primary">{{project.projects_name}}</h3>
                                                    {% if project.projects_description %}
                                                        <p class="text-muted">{{ project.projects_description|nl2br }}</p>
                                                        <hr/>
                                                    {% endif %}
                                                    {#
                                                    <div class="form-group" style="margin-top: 25px;">
                                                        <div class="custom-control custom-checkbox">
                                                            <input type="checkbox" class="custom-control-input" id="allow_excess_checkout" name="allow_excess_checkout" {% if project.allow_excess_checkout %}checked{% endif %}>
                                                            <label class="custom-control-label" for="allow_excess_checkout">
                                                                T√∂bb eszk√∂z kiaj√°nl√°s√°nak enged√©lyez√©se mint ami rakt√°rk√©szleten van
                                                            </label>
                                                        </div>
                                                    </div>
                                                    #}
                                                    <div class="text-muted">
                                                        {% if "PROJECTS:EDIT:CLIENT"|instancePermissions and project.projectsTypes_config_client == 1 %}
                                                            <div class="form-group">
                                                                <div class="d-flex justify-content-between align-items-end">
                                                                    <label class="font-weight-normal"for="editProjectClient">√úgyf√©l</label>
                                                                    <button type="button" class="btn btn-link" data-toggle="modal" data-target="#createClientModal">√úgyf√©l l√©trehoz√°sa</button>
                                                                </div>
                                                                <select class="form-control select2bs4" id="editProjectClient">
                                                                    {% if project.clients_id == "" %}
                                                                        <option value="" disabled selected>Nincs √ºgyf√©l kiv√°lasztva</option>
                                                                    {% endif %}
                                                                    {% for client in clients %}
                                                                        {% if client.clients_archived == 0 or ((client.clients_archived == 1) and (project.clients_id == client.clients_id) ) %}
                                                                            <option value="{{ client.clients_id }}" {{ project.clients_id == client.clients_id ? 'selected' }} {{ client.clients_archived == 1 ? 'disabled' }}>{{ client.clients_archived == 1 ? '[Archived] ' }}{{ client.clients_name }}</option>
                                                                        {% endif %}
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        {% elseif project.projectsTypes_config_client == 1  %}
                                                            <p class="text-sm">√úgyf√©l
                                                                <b class="d-block">
                                                                    <a  style="color: inherit; text-decoration: inherit;"  {% if "CLIENTS:VIEW"|instancePermissions %}href="{{ CONFIG.ROOTURL }}/clients.php"{% endif %}>
                                                                        {{ project.clients_name }}</a>
                                                                </b>
                                                            </p>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:LEAD"|instancePermissions %}
                                                            <div class="form-group">
                                                                <label class="font-weight-normal"for="editProjectManager">Projektmenedzser</label>
                                                                <select class="form-control select2bs4" id="editProjectManager">
                                                                    {% for user in potentialProjectManagers %}
                                                                        <option value="{{ user.users_userid }}" {{ project.users_userid == user.users_userid ? 'selected' }}>{{ (user.users_name1 ~ " " ~ user.users_name2) }}</option>
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                        {% else %}
                                                            <p class="text-sm">Projektmenedzser
                                                                <b class="d-block">
                                                                    {% if "BUSINESS:USERS:VIEW:INDIVIDUAL_USER"|instancePermissions %}
                                                                    <a style="color: inherit; text-decoration: inherit;" href="{{ CONFIG.ROOTURL }}/user.php?id={{ project.projects_manager }}">
                                                                        {% endif %}
                                                                        {{project.users_name1 ~ " " ~ project.users_name2 ~ " (" ~ project.users_email ~ ")" }}
                                                                        {% if "BUSINESS:USERS:VIEW:INDIVIDUAL_USER"|instancePermissions %}
                                                                    </a>
                                                                    {% endif %}
                                                                </b>
                                                            </p>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:ADDRESS"|instancePermissions and project.projectsTypes_config_venue == 1 %}
                                                            <div class="form-group">
                                                                <div class="d-flex justify-content-between align-items-end">
                                                                    <label class="font-weight-normal"for="editProjectAddress">Helysz√≠n</label>
                                                                    <button type="button" class="btn btn-link" data-toggle="modal" data-target="#createLocationModal">Helysz√≠n l√©trehoz√°sa</button>
                                                                </div>
                                                                <select class="form-control select2bs4" id="editProjectAddress">
                                                                    {% if project.locations_id == "" %}
                                                                        <option value="" disabled selected>Nincs helysz√≠n kiv√°lasztva...</option>
                                                                    {% endif %}
                                                                    {% for location in locations %}
                                                                        <option value="{{ location.locations_id }}" {{ project.locations_id == location.locations_id ? 'selected' }} {{ location.locations_archived == 1 ? 'disabled' }}>{{ location.locations_archived == 1 ? '[Archived] ' }}{{ location.locations_name }}</option>
                                                                        {% for subLocation in location.linkedToThis %}
                                                                            <option value="{{ subLocation.locations_id }}" {{ project.locations_id == subLocation.locations_id ? 'selected' }}  {{ subLocation.locations_archived == 1 ? 'disabled' }} title="{% for i in range(1, subLocation['tier']) %}{% if loop.last %}&#8627;{% else %}&nbsp;&nbsp;{% endif %}{% endfor %}">
                                                                                {{ subLocation.locations_archived == 1 ? '[Archived] ' }}{{ subLocation.locations_name }}
                                                                            </option>
                                                                        {% endfor %}
                                                                    {% endfor %}
                                                                </select>
                                                            </div>
                                                            {% if project.locations_id != "" %}
                                                                <!-- Google Maps link -->
                                                                <a class="btn btn-default btn-sm google-maps-btn" href="https://www.google.com/maps/search/?api=1&query={{ project.locations_address|replace({ "\r\n": ', ', "\n": ', ', "\r": ', '})|url_encode }}" target="_blank" title="Google Maps">
                                                                    <i class="fas fa-map-marked-alt fa-lg"></i>
                                                                </a>
                                                                <!-- Waze link -->
                                                                <a class="btn btn-default btn-sm waze-btn" href="https://waze.com/ul?q={{ project.locations_address|replace({ "\r\n": ' ', "\n": ' ', "\r": ' '})|url_encode }}" target="_blank" title="Waze">
                                                                    <i class="fab fa-waze fa-lg"></i>
                                                                </a>
                                                                <!-- Becs√ºlt t√°vols√°g -->
                                                                <div id="distance">Becs√ºlt t√°vols√°g a rakt√°rt√≥l: <span id="distance-value">...</span> </div>
                                                                <!-- Becs√ºlt utaz√°si id≈ë -->
                                                                <div id="duration">Becs√ºlt utaz√°si id≈ë a rakt√°rt√≥l: <span id="duration-value">...</span> </div>
                                                                <!-- Fogyaszt√°s √©s √ºzemanyag √°ra egym√°s mellett -->
                                                                <div class="form-group row">
                                                                    <!-- Fogyaszt√°s beviteli mez≈ë -->
                                                                    <div class="col-md-6">
                                                                        <label class="font-weight-normal" for="fuel-consumption">Fogyaszt√°s (liter/100 km)</label>
                                                                        <input type="number" class="form-control" id="fuel-consumption" value="10" step="0.1" min="1" max="25">
                                                                    </div>

                                                                    <!-- √územanyag √°ra beviteli mez≈ë -->
                                                                    <div class="col-md-6">
                                                                        <label class="font-weight-normal" for="fuel-price">√územanyag √°ra (Ft)</label>
                                                                        <input type="number" class="form-control" id="fuel-price" value="615" step="1" min="1" max="1500">
                                                                    </div>
                                                                </div>
                                                                <!-- Becs√ºlt utaz√°si k√∂lts√©g -->
                                                                <div class="mb-3" id="travel-cost">Becs√ºlt utaz√°si k√∂lts√©g: <span id="travel-cost-value">...</span></div>

                                                            {% endif %}
                                                        {% elseif project.projectsTypes_config_venue == 1 %}
                                                            <p class="text-sm">
                                                                Helysz√≠n
                                                                <b class="d-block">
                                                                    <a style="color: inherit; text-decoration: inherit;"  {% if "LOCATIONS:VIEW"|instancePermissions %}href="{{ CONFIG.ROOTURL }}/location/"{% endif %}>
                                                                        {% if project.locations_address %}
                                                                            <div> 
                                                                                {{ project.locations_name }}{% if project.locations_name and project.locations_address %} - {% endif %}{{ project.locations_address }}
                                                                            </div>
                                                                            <!-- Google Maps link -->
                                                                            <a class="btn btn-default btn-sm google-maps-btn" href="https://www.google.com/maps/search/?api=1&query={{ project.locations_address|replace({ "\r\n": ', ', "\n": ', ', "\r": ', '})|url_encode }}" target="_blank" title="Google Maps">
                                                                                <i class="fas fa-map-marked-alt fa-lg"></i>
                                                                            </a>
                                                                            <!-- Waze link -->
                                                                            <a class="btn btn-default btn-sm waze-btn" href="https://waze.com/ul?q={{ project.locations_address|replace({ "\r\n": ' ', "\n": ' ', "\r": ' '})|url_encode }}" target="_blank" title="Waze">
                                                                                <i class="fab fa-waze fa-lg"></i>
                                                                            </a>
                                                                            <!-- Becs√ºlt t√°vols√°g -->
                                                                            <div id="distance">Becs√ºlt t√°vols√°g a rakt√°rt√≥l: <span id="distance-value">...</span> </div>
                                                                            <!-- Becs√ºlt utaz√°si id≈ë -->
                                                                            <div id="duration">Becs√ºlt utaz√°si id≈ë a rakt√°rt√≥l: <span id="duration-value">...</span> </div>
                                                                        {% else %}
                                                                            {{ project.locations_name }}
                                                                        {% endif %}
                                                                    </a>
                                                                </b>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:DATES"|instancePermissions %}
                                                        <p class="text-sm">Esem√©ny id≈ëtartama                                                          
                                                        <div class="input-group">
                                                            <div class="input-group-prepend">
                                                                <span class="input-group-text"><i class="far fa-clock"></i></span>
                                                            </div>
                                                            <input type="text" class="form-control float-right" id="datePickerInput">
                                                        </div>

                                                        <p class="text-sm">√âp√≠t√©si nap
                                                            <div class="input-group">
                                                                <div class="input-group-prepend">
                                                                    <span class="input-group-text"><i class="far fa-clock"></i></span>
                                                                </div>
                                                                <input type="text" class="form-control float-right" id="buildDatePickerInput">
                                                            </div>
                                                        </p>
                                                        {% if project.projects_dates_use_start %}
                                                            <div style="width: 100%; text-align: right; margin-top: 5px; margin-bottom: 15px;">
                                                                <a href="#" class="copyProjectDatesToBuildDates" data-type="buildDatePickerInput" data-target="#buildDatePickerInput">
                                                                    <i class="fas fa-sync-alt"></i> Ugyanaz mint az esem√©ny id≈ëtartama
                                                                </a>
                                                            </div>
                                                        {% endif %}
                                                        {#
                                                        <p class="text-sm">Bont√°si nap
                                                            <div class="input-group">
                                                                <div class="input-group-prepend">
                                                                    <span class="input-group-text"><i class="far fa-clock"></i></span>
                                                                </div>
                                                                <input type="text" class="form-control float-right" id="demolitionDatePickerInput">
                                                            </div>
                                                        </p>
                                                        #}

                                                    {% else %}
                                                        <b class="d-block">Esem√©ny id≈ëtartama: {{ project.projects_dates_use_start ? project.projects_dates_use_start|date("Y. m. d. H:i") ~ ' - ' ~ project.projects_dates_use_end|date("Y. m. d. H:i") }}</b>
                                                        <b class="d-block">{{ project.projects_invoiceNotes ? project.projects_invoiceNotes}}</b>

                                                        {% endif %}
                                                        </p>
                                                        {% if project.projectsTypes_config_assets == 1 %}

                                                            {% set equipment_dates = {
                                                                "√Åltal√°nos eszk√∂z√∂k": {'icon': 'üìÖ', 'start': project.projects_dates_deliver_start, 'end': project.projects_dates_deliver_end},
                                                                "Technikai eszk√∂z√∂k": {'icon': 'üîä', 'start': project.projects_dates_tech_start, 'end': project.projects_dates_tech_end},
                                                                "Sz√≠npadi tart√≥szerkezeti eszk√∂z√∂k": {'icon': 'üè†', 'start': project.projects_dates_stageStructure_start, 'end': project.projects_dates_stageStructure_end},
                                                                "Sz√≠npadi eszk√∂z√∂k": {'icon': 'üõ†Ô∏è', 'start': project.projects_dates_stage_start, 'end': project.projects_dates_stage_end}
                                                            } %}

                                                            {% for label, data in equipment_dates %}
                                                                <p class="text-sm">
                                                                {{ data.icon }} Id≈ëtartam amikor a <strong>{{ label }}</strong> haszn√°lva vannak
                                                                </p>
                                                                {% if "PROJECTS:EDIT:DATES"|instancePermissions %}
                                                                    <div class="input-group">
                                                                        <div class="input-group-prepend">
                                                                            <span class="input-group-text"><i class="far fa-clock"></i></span>
                                                                        </div>
                                                                        <input type="text" class="form-control float-right datePickerInputDeliver"
                                                                            data-type="{{ label }}"
                                                                            data-start-date="{{ data.start ? data.start|date('Y. m. d. H:i') }}"
                                                                            data-end-date="{{ data.end ? data.end|date('Y. m. d. H:i') }}">
                                                                    </div>
                                                                    {% if project.projects_dates_use_start %}
                                                                        <div style="width: 100%; text-align: right; margin-top: 5px; margin-bottom: 15px;">
                                                                            <a href="#" class="copyProjectDatesToDeliverDates" data-type="{{ label }}">
                                                                                <i class="fas fa-sync-alt"></i> Ugyanaz mint az esem√©ny id≈ëtartama
                                                                            </a>
                                                                        </div>
                                                                    {% endif %}
                                                                {% else %}
                                                                    <b class="d-block">
                                                                        {{ data.start ? data.start|date("Y. m. d. H:i") ~ ' - ' ~ data.end|date("Y. m. d. H:i") }}
                                                                    </b>
                                                                {% endif %}
                                                            {% endfor %}

                                                            </p>
                                                            {% if "PROJECTS:EDIT:DATES"|instancePermissions %}
                                                            <p class="text-sm">Projekt id≈ëtartama sz√°ml√°z√°s miatt
                                                                <div class="input-group">
                                                                    <div class="input-group-prepend">
                                                                        <span class="input-group-text">Hetek</span>
                                                                    </div>
                                                                    <input type="number" min="0" step="1" max="256" value="{{ FINANCIALS['priceMaths']["weeks"] }}" class="form-control float-right" required id="financeDurationMathsHetek">
                                                                    <span class="input-group-text">Napok</span>
                                                                    <input type="number" min="0" step="1" max="256" value="{{ FINANCIALS['priceMaths']["days"] }}" class="form-control float-right" required id="financeDurationMathsDays">
                                                                    <div class="input-group-append">
                                                                        <button class="btn btn-default" type="button" id="financeDurationMathsSave">Ment√©s</button>
                                                                    </div>
                                                                </div>
                                                                {% if project.projects_dates_use_start %}
                                                                <div style="width: 100%;text-align: left;">
                                                                    {% if project.projects_dates_finances_days is same as(null) and project.projects_dates_finances_weeks is same as (null) %}
                                                                        A projekt id≈ëtartama jelenleg a projekt d√°tumain alapul
                                                                    {% else %}
                                                                     <a href="#" id="copyProjectDatesToFinanceDurationMaths">Szinkroniz√°l√°s a projekt d√°tumaival ({{ FINANCIALS['priceMaths']["calendarDays"] }} day{{ FINANCIALS['priceMaths']["calendarDays"] == 1 ? '' : 's' }})</a>
                                                                    {% endif %}
                                                                </div>
                                                                {% endif %}
                                                            {% endif %}
                                                            </p>
                                                        {% endif %}
                                                    </div>
                                                    <br/>
                                                    {% if project.projects_parent_project_id and project.projects_status_follow_parent %}
                                                        <div class="alert alert-info mb-1">
                                                            <p>Ez az alprojekt a sz√ºl≈ëprojekt √°llapot√°t k√∂veti</p>
                                                        </div> 
                                                    {% endif %}
                                                    <div class="alert" id="statusAlert" style="background-color: {{ project.projectsStatuses_backgroundColour }}; color: {{ project.projectsStatuses_foregroundColour }};">
                                                        <h5><b>√Ållapot: </b>{{ project.projectsStatuses_name }}</h5>
                                                        {{ project.projectsStatuses_description }}
                                                    </div>
                                                    <script>
                                                        let clickCount = 0;
                                                        const alertDiv = document.getElementById('statusAlert');
                                                        const gifUrl = "https://i0.wp.com/www.printmag.com/wp-content/uploads/2021/02/4cbe8d_f1ed2800a49649848102c68fc5a66e53mv2.gif?fit=476%2C280&ssl=1";
                                                        alertDiv.addEventListener('click', function() {
                                                            clickCount++;

                                                            if (clickCount === 5) {
                                                                alertDiv.innerHTML = `<img src="${gifUrl}" alt="Gif" style="width: 100%; height: 100%; border-radius: 15px;">`;
                                                            }
                                                        });
                                                    </script>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-footer">
                                            <div class="btn-group float-right">
                                                <button type="button" class="btn btn-default quickAddCommentButton">√öj megjegyz√©s</button>
                                                {% if "PROJECTS:EDIT:STATUS"|instancePermissions and not( project.projects_parent_project_id and project.projects_status_follow_parent) %}
                                                    <button type="button" class="btn btn-secondary" id="editProjectStatus">√Ållapot m√≥dos√≠t√°sa</button>
                                                {% endif %}
                                                {% if "ASSETS:CREATE"|instancePermissions %}
                                                <button type="button" class="btn btn-default dropdown-toggle dropdown-icon" data-toggle="dropdown">
                                                    <span class="sr-only">Leg√∂rd√ºl≈ë men√º v√°lt√°sa</span>
                                                    <div class="dropdown-menu" role="menu">
                                                        {% if "PROJECTS:CREATE"|instancePermissions %}
                                                            {% if project.subProjects == null %}
                                                                <a class="dropdown-item" id="assignParentProject">Sz√ºl≈ëprojekt hozz√°rendel√©se</a>
                                                            {% endif %}
                                                            {% if project.projects_parent_project_id == null %}
                                                                {% if canCreateSubProjects %}
                                                                    <a class="dropdown-item" id="newSubProject">√öj alprojekt</a>
                                                                {% endif %}
                                                            {% else %}
                                                                {% if project.projects_status_follow_parent %}
                                                                    <a class="dropdown-item" id="stopFollowParent">Sz√ºl≈ë √°llapot k√∂vet√©s√©nek le√°ll√≠t√°sa</a>
                                                                {% else %}
                                                                    <a class="dropdown-item" id="followParent">Sz√ºl≈ë √°llapot k√∂vet√©se</a>
                                                                {% endif %}
                                                            {% endif %}
                                                            {% if project.projects_parent_project_id == null or project.subProjects == null %}
                                                                <div class="dropdown-divider"></div>
                                                            {% endif %}
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:NAME"|instancePermissions %}
                                                            <a class="dropdown-item" id="editProjectName" href="#">N√©v szerkeszt√©se</a>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:DESCRIPTION_AND_SUB_PROJECTS"|instancePermissions %}
                                                            <a class="dropdown-item" id="editProjectDescription" href="#">Le√≠r√°s szerkeszt√©se</a>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:NAME"|instancePermissions or "PROJECTS:EDIT:DESCRIPTION_AND_SUB_PROJECTS"|instancePermissions %}
                                                            <div class="dropdown-divider"></div>
                                                        {% endif %}
                                                        {% if "PROJECTS:EDIT:PROJECT_TYPE"|instancePermissions and potentialProjectTypes|length > 1 %}
                                                            <a class="dropdown-item" id="editProjectType" href="#">Projekt t√≠pus√°nak m√≥dos√≠t√°sa</a>
                                                        {% endif %}
                                                        {% if "PROJECTS:ARCHIVE"|instancePermissions %}
                                                            {% if project.projects_archived == 1 %}
                                                                <a class="dropdown-item" id="archiveProject" href="#">Elt√°vol√≠t√°s az arch√≠vumb√≥l</a>
                                                            {% else %}
                                                                <a class="dropdown-item" id="archiveProject" href="#">Archiv√°l√°s</a>
                                                            {% endif %}
                                                        {% endif %}
                                                        {% if "PROJECTS:DELETE"|instancePermissions %}
                                                            <a class="dropdown-item" id="deleteProject" href="#">T√∂rl√©s</a>
                                                        {% endif %}
                                                    </div>
                                                </button>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-8 hidden-md-down">
                                    {% if project.crewAssignments|length > 0 %}
                                        <div class="card">
                                            <div class="card-header">
                                                {% set totalCrew = project.crewAssignments|length %}
                                                {% set confirmedCrew = 0 %}

                                                {% for crew in project.crewAssignments %}
                                                    {% if crew.crewAssignments_response == 1 %}
                                                        {% set confirmedCrew = confirmedCrew + 1 %}
                                                    {% endif %}
                                                {% endfor %}

                                                {% set allConfirmed = totalCrew > 0 and confirmedCrew == totalCrew %}

                                                {% if totalCrew > 0 %}
                                                    <div style="display: flex; align-items: center; gap: 10px; font-size: 1.2em; font-weight: bold;
                                                        color: {% if allConfirmed %}green{% else %}red{% endif %};
                                                        margin: 5px; justify-content: flex-start; text-align: left;">
                                                        <i class="fas fa-{% if allConfirmed %}check-circle{% else %}times-circle{% endif %}"></i>
                                                        {% if allConfirmed %}
                                                            Mindenki visszaigazolta a beoszt√°s√°t!
                                                        {% else %}
                                                            M√©g nem mindenki igazolta vissza a beoszt√°s√°t!
                                                        {% endif %}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    {% if project.auditLog|length > 0 %}
                                        <div class="card">
                                            <div class="card-header">
                                                <h3 class="card-title">Megjegyz√©sek</h3>
                                                <div class="card-tools">
                                                    <button type="button" class="btn btn-tool quickAddCommentButton" title="√öj megjegyz√©s" >
                                                        <i class="fas fa-plus"></i></button>
                                                </div>
                                            </div>
                                            <div class="card-body">
                                                <!-- The time line -->
                                                <div class="timeline">
                                                    {% set currentDate = '' %}
                                                    {% set comments = false %}
                                                    {% for event in project.auditLog %}
                                                        {% if event.auditLog_actionType in ['QUICKCOMMENT'] %}
                                                            {% set comments = true %}
                                                            {% if event.auditLog_timestamp|date("Y-m-d") != currentDate %}
                                                                <div class="time-label">
                                                                    <span class="bg-red">{{ event.auditLog_timestamp|date("Y. m. d.") }}</span>
                                                                </div>
                                                                {% set currentDate = event.auditLog_timestamp|date("Y-m-d") %}
                                                            {% endif %}
                                                            <div>
                                                                <i class="far fa-comment bg-blue"></i>
                                                                <div class="timeline-item">
                                                                    <span class="time"><i class="fas fa-clock"></i> {{ event.auditLog_timestamp|date("Y. m. d. H:i") }}</span>
                                                                    <span class="time">
                                                                        <i class="fas fa-tag"></i> {{ event.auditLog_targetID }} 
                                                                    </span>
                                                                    {% if "ASSETS:CREATE"|instancePermissions or event.users_userid == USERDATA.users_userid or event.auditLog_actionUserid == USERDATA.users_userid %}
                                                                    <button type="button" class="btn btn-tool quickDeleteCommentButton" data-comment-id="{{ event.auditLog_targetID }}" title="Megjegyz√©s t√∂rl√©se">
                                                                        <i class="fas fa-trash-alt text-danger"></i>
                                                                    </button>
                                                                    <button type="button" class="btn btn-tool quickEditCommentButton" data-comment-id="{{ event.auditLog_targetID }}" title="Megjegyz√©s szerkeszt√©se">
                                                                        <i class="fas fa-pencil-alt text-warning"></i>
                                                                    </button>
                                                                    {% endif %}
                                                                    <h3 class="timeline-header"><a href="mailto:{{ event.users_email }}">{{ event.users_name1 ~ " " ~ event.users_name2 }} </a> hozz√°sz√≥lt
                                                                    </h3>
                                                                    <div class="timeline-body">{{ event.auditLog_actionData|raw }}</div>
                                                                </div>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor %}
                                                    {% if comments %}
                                                        <div>
                                                            <i class="fas fa-clock bg-gray"></i>
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="btn-group float-left" style="margin-bottom: 15px; margin-left: 15px;">
                                                <div>
                                                    {% set vechiles = [
                                                        {"name": "Renault: NEA-418"},
                                                        {"name": "Dyna: ISE-230"},
                                                        {"name": "Ford: NIC-477"}
                                                    ] %}
                                                    
                                                    {% if "ASSETS:CREATE"|instancePermissions %}
                                                        <button type="button" class="btn btn-default dropdown-toggle dropdown-icon" data-toggle="dropdown">
                                                            G√©pj√°rm≈± kiv√°laszt√°sa
                                                            <span class="sr-only">Leg√∂rd√ºl≈ë men√º v√°lt√°sa</span>
                                                        </button>
                                                        <div class="dropdown-menu" role="menu">
                                                            {% if "PROJECTS:CREATE"|instancePermissions %}
                                                                {% for truck in vechiles %}
                                                                    <a class="dropdown-item addTruck" href="#" data-target="{{ truck.name }}" >{{ truck.name }}</a>
                                                                {% endfor %}
                                                            {% endif %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                                <div>
                                                    {% set trailers = [
                                                        {"name": "Renault nagy ut√°nfut√≥: WAV-542"},
                                                        {"name": "Sz√≠npados ut√°nfut√≥: WCN-677"},
                                                        {"name": "Kis tet≈ës ut√°nfut√≥: WBM-746"}
                                                    ] %}

                                                    {% if "ASSETS:CREATE"|instancePermissions %}
                                                        <button type="button" class="btn btn-default dropdown-toggle dropdown-icon" data-toggle="dropdown">
                                                            Ut√°nfut√≥ kiv√°laszt√°sa
                                                            <span class="sr-only">Leg√∂rd√ºl≈ë men√º v√°lt√°sa</span>
                                                        </button>
                                                        <div class="dropdown-menu" role="menu">
                                                            {% if "PROJECTS:CREATE"|instancePermissions %}
                                                                {% for trailer in trailers %}
                                                                    <a class="dropdown-item addTrailer" href="#" data-target="{{ trailer.name }}" >{{ trailer.name }}</a>
                                                                {% endfor %}
                                                            {% endif %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane" id="assets-view">
                            {% if (FINANCIALS['assetsAssigned'] or FINANCIALS['assetsAssignedSUB']) and project.projectsTypes_config_assets == 1 %}
                                {% embed 'project/project_assets.twig' %}{% endembed %}
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="assets-board">
                            {% if (FINANCIALS['assetsAssigned'] or FINANCIALS['assetsAssignedSUB']) and project.projectsTypes_config_assets == 1 %}
                                {% embed 'project/project_assetsBoard.twig' %}{% endembed %}
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="file-view">
                            {% embed 'project/project_files.twig' %}{% endembed %}
                        </div>
                        <div class="tab-pane" id="payments-view">
                            {% if "PROJECTS:PROJECT_PAYMENTS:VIEW"|instancePermissions and project.projectsTypes_config_finance == 1 %}
                                {% embed 'project/project_finance.twig' %}{% endembed %}
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="crew-view">
                            {% if "PROJECTS:PROJECT_CREW:VIEW"|instancePermissions and project.projectsTypes_config_crew == 1 %}
                                {% embed 'project/project_crew.twig' %}{% endembed %}
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="calendar-view">
                            {% if project.subProjects %}
                                    <div class="card">
                                        <div class="card-body p-0">
                                            {% embed 'assets/widgets/calendar.twig' with {"projects": project.subProjects, "useStartDate": true } %}
                                            {% endembed %}
                                        </div>
                                    </div>
                            {% endif %}
                        </div>
                        <div class="tab-pane" id="log-view">
                            {% embed 'project/project_log.twig' %}{% endembed %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if "PROJECTS:PROJECT_PAYMENTS:CREATE"|instancePermissions %}
    <div class="modal fade" id="newPaymentModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="newPaymentModal-title"></h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>  
            <div class="modal-body">
                <form id="newPaymentModal-form">
                    <input type="hidden" id="newPaymentModal-form-type" name="payments_type" value="1"/>
                    <input type="hidden" name="projects_id" value="{{ project.projects_id }}"/>
                    <div class="input-group newPaymentModal-paymentOnly" style="margin-bottom: 5px;">
                        <div class="input-group-prepend">
                            <span class="input-group-text">D√°tum</span>
                        </div>
                        <input type="text" class="form-control" name="payments_date" id="newPaymentModal-form-date">
                    </div>
                    <div class="input-group newPaymentModal-paymentOnly" style="margin-bottom: 5px;">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Hivatkoz√°s</span>
                        </div>
                        <input type="text" class="form-control" name="payments_reference" value="{{ project.projects_id }}">
                    </div>
                    <div class="input-group newPaymentModal-paymentOnly" style="margin-bottom: 5px;">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Fizet√©si M√≥dszer</span>
                        </div>
                        <select class="form-control" name="payments_method">
                            <option selected></option>
                            <option>Hitelk√°rtya</option>
                            <option>Bankk√°rtya</option>
                            <option>Banki √°tutal√°s</option>
                            <option>K√©szp√©nz</option>
                            <option>Csekk</option>
                            <option>Egy√©b</option>
                        </select>
                    </div>

                    <div>
                        {% set staffHourMoney = [
                            {"name": "Ep√≠t≈ë - bont√≥ munkaer≈ë", "money": 2500},
                            {"name": "Technikusi munkaer≈ë", "money": 3500}
                        ] %}

                        <div class="input-group newPaymentModal-paymentHour" style="margin-bottom: 5px;">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Munkaer≈ë t√≠pus</span>
                            </div>
                            <select class="form-control" id="payments_workforceType" onchange="updateHourlyRate()">
                                <option selected></option>
                                {% for staff in staffHourMoney %}
                                    <option value="{{ staff.money }}">{{ staff.name }}</option>
                                {% endfor %}
                            </select>
                        </div>    

                        <div class="input-group mb-3 newPaymentModal-paymentHour">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Mennyis√©g</span>
                            </div>
                            <input class="form-control" type="number" step="1" min="0" value="0" id="payments_quantity_hourly" name="payments_quantity_hourly" oninput="calculateTotalHourlyRate(); updateDescription();">
                        </div>

                        <div class="input-group mb-3 newPaymentModal-paymentHour">
                            <div class="input-group-prepend">
                                <span class="input-group-text">√ìra</span>
                            </div>
                            <input class="form-control" type="number" step="1" min="0" value="0" id="payments_hours" name="payments_hours" oninput="calculateTotalHourlyRate(); updateDescription();">
                        </div>

                        <div class="input-group mb-3 newPaymentModal-paymentHour">
                            <div class="input-group-prepend">
                                <span class="input-group-text">√ìrab√©r</span>
                            </div>
                            <input class="form-control" type="number" step="1" min="0" id="payments_hourlyRate"  oninput="calculateTotalHourlyRate()">
                        </div>

                        <div class="input-group mb-3 newPaymentModal-paymentHour">
                            <div class="input-group-prepend">
                                <span class="input-group-text">√ñsszesen/f≈ë</span>
                            </div>
                            <input class="form-control" type="number" step="1" min="0" id="payments_amount_hourly" name="payments_amount_hourly" readonly>
                        </div>

                        <div class="input-group newPaymentModal-paymentHour" style="margin-bottom: 5px;">
                            <div class="input-group-prepend"><span class="input-group-text">Le√≠r√°s</span></div>
                            <textarea class="form-control" rows="3" name="payments_comment_hourly" id="payments_comment_hourly" placeholder=""></textarea>
                        </div>

                        <script>
                        // Function to update hourly rate based on the selected workforce type
                        function updateHourlyRate() {
                            const workforceType = document.getElementById('payments_workforceType');
                            const hourlyRate = document.getElementById('payments_hourlyRate');
                            hourlyRate.value = workforceType.value;
                            calculateTotalHourlyRate(); // Recalculate total when workforce type is selected
                        }

                        // Function to calculate the total hourly rate (Mennyis√©g * √ìra * √ìrab√©r)
                        function calculateTotalHourlyRate() {
                            const quantity = document.getElementById('payments_quantity_hourly').value || 0; 
                            const hours = document.getElementById('payments_hours').value || 0;
                            const hourlyRate = document.getElementById('payments_hourlyRate').value || 0;
                            const total = document.getElementById('payments_amount_hourly');
                            total.value = hours * hourlyRate; // Calculate total as Mennyis√©g * √ìra * √ìrab√©r
                        }

                        // Function to update the description with the current quantity, hours, and hourly rate
                        function updateDescription() {
                            const workforceType = document.getElementById('payments_workforceType');
                            const selectedType = workforceType.options[workforceType.selectedIndex].text; // Get the name of the selected workforce type
                            const quantity = document.getElementById('payments_quantity_hourly').value || 0;
                            const hours = document.getElementById('payments_hours').value || 0;
                            const description = document.getElementById('payments_comment_hourly');
                            
                            if (description) { // Check if the element exists
                                const totalHours = quantity * hours; // Multiply the quantity and hours
                                description.value = `${selectedType}: √ñsszesen ${totalHours} √≥ra`; // Update description with the calculated total hours
                            }
                        }

                        // Call the calculation function once on page load to initialize the total if any value is selected
                        window.onload = function() {
                            calculateTotalHourlyRate();
                        }
                        </script>
                    </div>


                    
                    <div class="input-group mb-3 newPaymentModal-nonPaymentOnly">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Mennyis√©g</span>
                        </div>
                        <input class="form-control" type="number" step="1" min="0" value="1" name="payments_quantity">
                    </div>
                    <div class="input-group mb-3 newPaymentModal-paymentSimple">
                        <div class="input-group-prepend">
                            <span class="input-group-text">Sz√°ll√≠t√≥</span>
                        </div>
                        <input class="form-control" type="text" name="payments_supplier">
                    </div>
                    <div class="input-group newPaymentModal-nonPaymentOnly" style="margin-bottom: 5px;">
                        <div class="input-group-prepend"><span class="input-group-text">Le√≠r√°s</span></div>
                        <textarea class="form-control" rows="3" name="payments_comment"  placeholder=""></textarea>
                    </div>
                    <div class="input-group mb-3 newPaymentModal-nonPaymentOnly newPaymentModal-PaymentOnly">
                        <div class="input-group-prepend">
                            <span class="input-group-text">√ñsszeg {{ moneySymbol() }}</span>
                        </div>
                        <input class="form-control" type="number" step="0.01" min="0" value="0" name="payments_amount">
                    </div>
                </form>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal">Bez√°r√°s</button>
                <button type="button" class="btn btn-primary" id="newPaymentModal-button">V√°ltoztat√°sok ment√©se</button>
            </div>
        </div>
    </div>
    </div>
    {% endif %}
    {% if "PROJECTS:PROJECT_NOTES:EDIT:NOTES"|instancePermissions and project.projectsTypes_config_notes == 1 %}
        {% for note in project.notes %}
            <div class="modal fade" id="noteModal{{ note.projectsNotes_id }}">
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">Szerkeszt√©s: {{ note.projectsNotes_title }}</h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body p-0">
                            <div class="summernote" data-noteid="{{ note.projectsNotes_id }}">{{ note.projectsNotes_text|raw }}</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default btn-sm noteModal-save" data-noteid="{{ note.projectsNotes_id }}" data-callback="print"><i class="fas fa-print"></i> Ment√©s √©s Nyomtat√°s</button>
                            <button type="button" class="btn btn-default btn-sm noteModal-save" data-noteid="{{ note.projectsNotes_id }}" data-callback="none"><i class="far fa-save"></i> Ment√©s</button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% endif %}
    {% if "PROJECTS:PROJECT_CREW:CREATE"|instancePermissions %}
        <div class="modal fade" id="addCrewModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Csapat hozz√°ad√°sa {{ project.projects_name }}</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="addCrewModal-form">
                            <input type="hidden" name="projects_id" value="{{ project.projects_id }}"/>
                            <div class="input-group mb-3">
                                <select class="form-control" multiple="multiple" id="addCrewModal-users" placeholder="Enter names here"></select>
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Beoszt√°s</span>
                                </div>
                                <input class="form-control" type="text" name="crewAssignments_role" minlength="2" required placeholder="Head Flyman">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend"><span class="input-group-text">Hozz√°sz√≥l√°s</span></div>
                                <textarea class="form-control" rows="3" name="crewAssignments_comment" placeholder="Making own way to venue - bringing key to operate drum revolve. Designated FirstAider"></textarea>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Bez√°r√°s</button>
                        <button type="button" class="btn btn-primary" id="addCrewModal-button">Hozz√°ad√°s</button>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {% if "PROJECTS:PROJECT_CREW:VIEW:EMAIL_CREW"|instancePermissions %}
        <div class="modal fade" id="emailCrewModal">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Crew e-mailek a(z)  {{ project.projects_name }}</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <pre>{% for crew in project.crewAssignments  %}{% if crew.users_email != null %}{{ crew.users_name1 }} {{ crew.users_name2 }} &lt;{{ crew.users_email }}&gt;,{% endif %}{% endfor %}</pre>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Bez√°r√°s</button>
                        <a href="mailto:?subject={{ project.projects_name }}&bcc={% for crew in project.crewAssignments  %}{% if crew.users_email != null %}{{ crew.users_email }},{% endif %}{% endfor %}" type="button" class="btn btn-primary">Launch Email Client</a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    {% if CONFIG.FILES_ENABLED == "Enabled" and USERDATA.instance.instances_storageEnabled == 1 and "PROJECTS:PROJECT_PAYMENTS:VIEW:FILE_ATTACHMENTS"|instancePermissions %}
    {% for payment in []|merge(FINANCIALS.payments.received.ledger)|merge(FINANCIALS.payments.sales.ledger)|merge(FINANCIALS.payments.subHire.ledger)|merge(FINANCIALS.payments.staff.ledger) %}
        <div class="modal fade" id="filesModal{{ payment.payments_id }}">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Kifizet√©si f√°jlok</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {% embed 'assets/templates/fileBox.twig' with {'files': payment.files } %}
                        {% endembed %}
                    </div>
                    {% if "PROJECTS:PROJECT_PAYMENTS:CREATE:FILE_ATTACHMENTS"|instancePermissions %}
                        <div class="modal-footer">
                            {% embed 'assets/templates/uppy.twig' with {'type': 'PAYMENT-FILE', 'paste': true, 'typeId': 14, 'subTypeId': payment.payments_id, 'imagesOnly': false } %}
                                {% block success %}
                                    console.log(responseJson.id);
                                {% endblock %}
                            {% endembed %}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endfor %}
    {% endif %}
    {% if CONFIG.FILES_ENABLED == "Enabled" and USERDATA.instance.instances_storageEnabled == 1 and project.projectsTypes_config_files == 1 %}

    <div class="modal fade" id="projectFilesModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Projekt f√°jlok</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {% embed 'assets/templates/fileBox.twig' with {'files': files } %}
                    {% endembed %}
                </div>
                {% if "PROJECTS:PROJECT_FLIE_ATTACHMENTS:CREATE"|instancePermissions %}
                    <div class="modal-footer">
                        {% embed 'assets/templates/uppy.twig' with {'type': 'PROJECT-FILE', 'paste': true, 'typeId': 7, 'subTypeId': project.projects_id, 'imagesOnly': false } %}
                            {% block success %}
                                console.log(responseJson.id);
                            {% endblock %}
                        {% endembed %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
    <div class="modal fade" id="projectQuotesModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Projekt √Åraj√°nlatok</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {% embed 'assets/templates/fileBox.twig' with {'files': quotes } %}


                    {% endembed %}
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="projectInvoicesModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Projekt Sz√°ml√°k</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {% embed 'assets/templates/fileBox.twig' with {'files': invoices } %}
                    {% endembed %}
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="projectTrucksModal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Projekt Bepakol√°si list√°k</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {% embed 'assets/templates/fileBox.twig' with {'files': trucks } %}
                    {% endembed %}
                </div>
            </div>
        </div>
    </div>
    {#
    Invoice
    #}
    <div class="modal fade" id="pdfGenerateModalInvoice">
        <div class="modal-dialog">
            <form id="pdfGenerate" method="GET" action="{{CONFIG.ROOTURL}}/project/projectInvoice.php" target="_blank">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"></h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="pdf" value="true">
                        <input type="hidden" name="quote" value="false">
                        <input type="hidden" name="id" value="{{ project.projects_id }}">
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="instancelogo" {% if USERDATA.instance.instances_logo %}checked{% else %}disabled{% endif %}>
                                <label class="form-check-label">V√°llalati log√≥</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="addresses" checked>
                                <label class="form-check-label">C√≠mek</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="pmdetails" checked>
                                <label class="form-check-label">Projektmenedzser</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalmass" checked>
                                    <label class="form-check-label">Teljes t√∂meg</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalvalue" >
                                    <label class="form-check-label">Teljes √©rt√©k</label>
                                </div>
                            {% endif %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="venue" checked>
                                <label class="form-check-label">Helysz√≠n</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="invoiceNotes">
                                <label class="form-check-label">Sz√°mla megjegyz√©sek</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="assets" checked>
                                    <label class="form-check-label">Berendez√©sek list√°ja</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="showAll">
                                    <label class="form-check-label">Egy√©ni t√©telek a berendez√©s list√°j√°ban</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="flagsBlocks" checked>
                                    <label class="form-check-label">Z√°szl√≥k √©s blokkok a berendez√©s list√°j√°ban</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="checkboxes">
                                    <label class="form-check-label">Berendez√©s jel√∂l≈ën√©gyzetek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="comments">
                                    <label class="form-check-label">Berendez√©s megjegyz√©sek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="masses" checked>
                                    <label class="form-check-label">Berendez√©s t√∂megei</label>
                                </div>
                            {% endif %}

                            {% if "PROJECTS:PROJECT_PAYMENTS:VIEW"|instancePermissions and project.projectsTypes_config_finance == 1  %}
                                <hr/>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="finance" checked>
                                    <label class="form-check-label">P√©nz√ºgyi √∂sszegek</label>
                                </div>
                                {% if project.projectsTypes_config_assets == 1 %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="prices" checked>
                                        <label class="form-check-label">√Årak</label>
                                    </div>
                                    {#
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="discounts">
                                        <label class="form-check-label">Berendez√©sek kedvezm√©nyei</label>
                                    </div>
                                    #}
                                {% endif %}
                                {#
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="subHires" checked>
                                    <label class="form-check-label">Tov√°bbi b√©rlem√©nyek</label>
                                </div>
                                #}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="sales" checked>
                                    <label class="form-check-label">√ârt√©kes√≠t√©s</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="staff" checked>
                                    <label class="form-check-label">Munkav√°llal√≥k</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="paymentTerms" checked>
                                    <label class="form-check-label">Fizet√©si felt√©telek</label>
                                </div>
                            {% endif %}

                        </div>
                    </div>
                    {% if "ASSETS:CREATE"|instancePermissions %}
                    <div class="modal-footer justify-content-between">
                        <button type="submit" name="draft" value="true" class="btn btn-default">Piszkozat nyomtat√°s</button>
                        <button type="submit" name="upload" value="true" class="btn btn-success">PDF gener√°l√°sa</button>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
    {#
    Quote
    #}
    <div class="modal fade" id="pdfGenerateModalQuote">
        <div class="modal-dialog">
            <form id="pdfGenerate" method="GET" action="{{CONFIG.ROOTURL}}/project/projectInvoice.php" target="_blank">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"></h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="pdf" value="true">
                        <input type="hidden" name="quote" value="true">
                        <input type="hidden" name="id" value="{{ project.projects_id }}">
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="instancelogo" {% if USERDATA.instance.instances_logo %}checked{% else %}disabled{% endif %}>
                                <label class="form-check-label">V√°llalati log√≥</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="addresses" checked>
                                <label class="form-check-label">C√≠mek</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="pmdetails" checked>
                                <label class="form-check-label">Projektmenedzser</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalmass" checked>
                                    <label class="form-check-label">Teljes t√∂meg</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalvalue" >
                                    <label class="form-check-label">Teljes √©rt√©k</label>
                                </div>
                            {% endif %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="venue" checked>
                                <label class="form-check-label">Helysz√≠n</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="invoiceNotes">
                                <label class="form-check-label">Sz√°mla megjegyz√©sek</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="assets" checked>
                                    <label class="form-check-label">Berendez√©sek list√°ja</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="showAll">
                                    <label class="form-check-label">Egy√©ni t√©telek a berendez√©s list√°j√°ban</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="flagsBlocks" checked>
                                    <label class="form-check-label">Z√°szl√≥k √©s blokkok a berendez√©s list√°j√°ban</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="checkboxes">
                                    <label class="form-check-label">Berendez√©s jel√∂l≈ën√©gyzetek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="comments">
                                    <label class="form-check-label">Berendez√©s megjegyz√©sek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="masses" checked>
                                    <label class="form-check-label">Berendez√©s t√∂megei</label>
                                </div>
                            {% endif %}

                            {% if "PROJECTS:PROJECT_PAYMENTS:VIEW"|instancePermissions and project.projectsTypes_config_finance == 1  %}
                                <hr/>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="finance" checked>
                                    <label class="form-check-label">P√©nz√ºgyi √∂sszegek</label>
                                </div>
                                {% if project.projectsTypes_config_assets == 1 %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="prices" checked>
                                        <label class="form-check-label">√Årak</label>
                                    </div>
                                    {#
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="discounts">
                                        <label class="form-check-label">Berendez√©sek kedvezm√©nyei</label>
                                    </div>
                                    #}
                                {% endif %}
                                {#
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="subHires" checked>
                                    <label class="form-check-label">Tov√°bbi b√©rlem√©nyek</label>
                                </div>
                                #}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="sales" checked>
                                    <label class="form-check-label">√ârt√©kes√≠t√©s</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="staff" checked>
                                    <label class="form-check-label">Munkav√°llal√≥k</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="paymentTerms" checked>
                                    <label class="form-check-label">Fizet√©si felt√©telek</label>
                                </div>
                            {% endif %}

                        </div>
                    </div>
                    {% if "ASSETS:CREATE"|instancePermissions %}
                    <div class="modal-footer justify-content-between">
                        <button type="submit" name="draft" value="true" class="btn btn-default">Piszkozat nyomtat√°s</button>
                        <button type="submit" name="upload" value="true" class="btn btn-success">PDF gener√°l√°sa</button>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
    {#
    Truck
    #}
    <div class="modal fade" id="pdfGenerateModalTruck">
        <div class="modal-dialog">
            <form id="pdfGenerate" method="GET" action="{{CONFIG.ROOTURL}}/project/projectInvoice.php" target="_blank">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title"></h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" name="pdf" value="true">
                        <input type="hidden" name="quote" value="truck">
                        <input type="hidden" name="id" value="{{ project.projects_id }}">
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="instancelogo" {% if USERDATA.instance.instances_logo %}checked{% else %}disabled{% endif %}>
                                <label class="form-check-label">V√°llalati log√≥</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="addresses" checked>
                                <label class="form-check-label">C√≠mek</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="pmdetails" checked>
                                <label class="form-check-label">Projektmenedzser</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalmass" checked>
                                    <label class="form-check-label">Teljes t√∂meg</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="totalvalue">
                                    <label class="form-check-label">Teljes √©rt√©k</label>
                                </div>
                            {% endif %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="venue" checked>
                                <label class="form-check-label">Helysz√≠n</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="invoiceNotes">
                                <label class="form-check-label">Sz√°mla megjegyz√©sek</label>
                            </div>
                            {% if project.projectsTypes_config_assets == 1 %}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="assets" checked>
                                    <label class="form-check-label">Berendez√©sek list√°ja</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="showAll">
                                    <label class="form-check-label">Egy√©ni t√©telek a berendez√©s list√°j√°ban</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="flagsBlocks" checked>
                                    <label class="form-check-label">Z√°szl√≥k √©s blokkok a berendez√©s list√°j√°ban</label>
                                </div>

                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="checkboxes" checked>
                                    <label class="form-check-label">Berendez√©s jel√∂l≈ën√©gyzetek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="comments">
                                    <label class="form-check-label">Berendez√©s megjegyz√©sek</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="masses" checked>
                                    <label class="form-check-label">Berendez√©s t√∂megei</label>
                                </div>
                            {% endif %}

                            {% if "PROJECTS:PROJECT_PAYMENTS:VIEW"|instancePermissions and project.projectsTypes_config_finance == 1  %}
                                <hr/>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="finance">
                                    <label class="form-check-label">P√©nz√ºgyi √∂sszegek</label>
                                </div>
                                {% if project.projectsTypes_config_assets == 1 %}
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="prices">
                                        <label class="form-check-label">√Årak</label>
                                    </div>
                                    {#
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="discounts">
                                        <label class="form-check-label">Berendez√©sek kedvezm√©nyei</label>
                                    </div>
                                    #}
                                {% endif %}
                                {#
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="subHires">
                                    <label class="form-check-label">Tov√°bbi b√©rlem√©nyek</label>
                                </div>
                                #}
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="sales">
                                    <label class="form-check-label">√ârt√©kes√≠t√©s</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="staff">
                                    <label class="form-check-label">Munkav√°llal√≥k</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="paymentTerms">
                                    <label class="form-check-label">Fizet√©si felt√©telek</label>
                                </div>
                            {% endif %}

                        </div>
                    </div>
                    {% if "ASSETS:CREATE"|instancePermissions %}
                    <div class="modal-footer justify-content-between">
                        <button type="submit" name="draft" value="true" class="btn btn-default">Piszkozat nyomtat√°s</button>
                        <button type="submit" name="upload" value="true" class="btn btn-success">PDF gener√°l√°sa</button>
                    </div>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    {% if "CLIENTS:CREATE"|instancePermissions %}
        {% embed 'assets/templates/modals/createClient.twig' %}{% endembed %}
    {% endif %}
    {% if "LOCATIONS:CREATE"|instancePermissions %}
        {% embed 'assets/templates/modals/createLocation.twig' %}{% endembed %}
    {% endif %}

    <script>

        const warehouseAddress = '9174 Dunaszeg Iskola utca 7';  // Fixed address
        // Function to geocode the address
        function geocodeAddress(address, callback) {
            const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(address)}&format=jsonv2&limit=1`;

            console.log('Requesting route data from Nominatim:', url); 

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const latitude = data[0].lat;  // Using lat from the response
                        const longitude = data[0].lon;  // Using lon from the response
                        callback({ lat: latitude, lon: longitude });
                    } else {
                        console.log('C√≠m nem tal√°lhat√≥');
                    }
                })
                .catch(error => console.log('Hiba a geok√≥dol√°s sor√°n:', error));
        }

        // Function to calculate distance and duration
        function calculateRoute(startCoords, endCoords) {
            // Ensuring the coordinates are valid
            if (!startCoords || !endCoords || !startCoords.lon || !startCoords.lat || !endCoords.lon || !endCoords.lat) {
                console.log('Invalid coordinates');
                return;
            }

            const osrmUrl = `https://router.project-osrm.org/route/v1/car/${startCoords.lon},${startCoords.lat};${endCoords.lon},${endCoords.lat}?overview=false&annotations=duration,distance`;
            console.log('Requesting route data from OSRM:', osrmUrl); 

            fetch(osrmUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.routes && data.routes.length > 0) {
                        const route = data.routes[0];
                        const distanceKm = route.distance / 1000; // in km
                        let durationMin = route.duration / 60; // in minutes

                        // Assuming the truck is slower than a car (adjust this factor based on your case)
                        const truckFactor = 1.15;  // Truck is slower
                        durationMin = durationMin * truckFactor;

                        // Convert duration from minutes to hours and minutes
                        const hours = Math.floor(durationMin / 60);
                        const minutes = Math.round(durationMin % 60);

                        // Update the UI with the distance and duration in hours and minutes
                        document.getElementById('distance-value').textContent = `${distanceKm.toFixed(2)} km`;
                        document.getElementById('duration-value').textContent = `${hours} √≥ra ${minutes} perc`;
                        
                        // Once distance is available, automatically calculate the travel cost
                        calculateTravelCost(distanceKm); // Automatically calculate with default values
            } else {
                        console.log('No route found');
                    }
                })
                .catch(error => console.log('Error fetching route data:', error));
        }

        // Function to calculate travel cost
        function calculateTravelCost(distance) {
            const fuelConsumption = parseFloat(document.getElementById('fuel-consumption').value) || 1;  // Default to 1 if no value is provided
            const fuelPrice = parseFloat(document.getElementById('fuel-price').value) || 1;      // Default to 1 if no value is provided

            if (isNaN(distance) || isNaN(fuelConsumption) || isNaN(fuelPrice)) {
                alert('K√©rj√ºk, adja meg a t√°vols√°got, a fogyaszt√°st √©s az √ºzemanyag √°r√°t.');
                console.log('No data found');
                return;
            }

            // Travel cost calculation
            const cost = distance  * (fuelConsumption / 100) * fuelPrice * 2; // Multiply by 2 for round trip
            
            // Round the cost to the nearest integer (whole Ft)
            const roundedCost = Math.round(cost);

            // Display the rounded cost with " Ft" appended
            document.getElementById('travel-cost-value').textContent = roundedCost.toString().replace(/,/g, '.') + ' Ft';
        }
        
        // Geocode both addresses and calculate the route when both are ready
        function getRoute() {
            console.log("Start getRoute function");
            geocodeAddress(warehouseAddress, function(warehouseCoords) {
                // A project.locations_address-t k√≥dold itt a JavaScript-ben
                const projectAddress = "{{ project.locations_address|replace({ '\r\n': ', ', '\n': ', ', '\r': ', '}) }}";  
                const encodedProjectAddress = encodeURIComponent(projectAddress); // JavaScript-ben t√∂rt√©n≈ë k√≥dol√°s
                console.log("Encoded Project Address: ", encodedProjectAddress);
                
                geocodeAddress(projectAddress, function(projectCoords) {
                    calculateRoute(warehouseCoords, projectCoords);
                });
            });
        }

        // Function to ensure the fuel consumption stays within the min/max values
        function validateFuelConsumption() {
            const fuelConsumptionInput = document.getElementById('fuel-consumption');
            const value = parseFloat(fuelConsumptionInput.value);

            if (value < parseFloat(fuelConsumptionInput.min)) {
                fuelConsumptionInput.value = fuelConsumptionInput.min;
            } else if (value > parseFloat(fuelConsumptionInput.max)) {
                fuelConsumptionInput.value = fuelConsumptionInput.max;
            }
        }

        // Function to ensure the fuel price stays within the min/max values
        function validateFuelPrice() {
            const fuelPriceInput = document.getElementById('fuel-price');
            const value = parseFloat(fuelPriceInput.value);

            if (value < parseFloat(fuelPriceInput.min)) {
                fuelPriceInput.value = fuelPriceInput.min;
            } else if (value > parseFloat(fuelPriceInput.max)) {
                fuelPriceInput.value = fuelPriceInput.max;
            }
        }

        // Event listener for fuel consumption
        const fuelConsumptionElement = document.getElementById('fuel-consumption');
        if (fuelConsumptionElement) {
            fuelConsumptionElement.addEventListener('input', function() {
                validateFuelConsumption();  // Validate fuel consumption
                const distance = parseFloat(document.getElementById('distance-value').textContent);
                if (!isNaN(distance)) {
                    calculateTravelCost(distance);  // Recalculate the cost
                }
            });
        }

        // Event listener for fuel price
        const fuelPriceElement = document.getElementById('fuel-price');
        if (fuelPriceElement) {
            fuelPriceElement.addEventListener('input', function() {
                validateFuelPrice();  // Validate fuel price
                const distance = parseFloat(document.getElementById('distance-value').textContent);
                if (!isNaN(distance)) {
                    calculateTravelCost(distance);  // Recalculate the cost
                }
            });
        }

        document.addEventListener("DOMContentLoaded", function() {
            console.log("Oldal bet√∂lt≈ëd√∂tt.");
            getRoute();
        });


        $(document).ready(function () {

            $(".addTruck").click(function () {
                let truckNumber = $(this).data("target");
               
                if (truckNumber) {
                    let uniqueID = Math.floor((Date.now() + Math.random()) % 1000000000);
                    let logMessage = "G√©pj√°rm≈± => " + truckNumber;
                    
                    // Call ajax with the log message
                    ajaxcall("projects/newQuickComment.php", {
                        "text": logMessage,
                        "projects_id": "{{ project.projects_id }}",
                        "uniqueID": uniqueID
                    }, function (data) {
                        location.reload();
                    });
                }
            });

            $(".addTrailer").click(function () {
                let trailerNumber = $(this).data("target");
                
                if (trailerNumber) {
                    let uniqueID = Math.floor((Date.now() + Math.random()) % 1000000000);
                    let logMessage = "Ut√°nfut√≥ => " + trailerNumber;
                    
                    // Call ajax with the log message
                    ajaxcall("projects/newQuickComment.php", {
                        "text": logMessage,
                        "projects_id": "{{ project.projects_id }}",
                        "uniqueID": uniqueID
                    }, function (data) {
                        location.reload();
                    });
                }
            });

            $(".quickDeleteCommentButton").click(function () {
                var comment_id = $(this).data("comment-id");
                var projects_id = "{{ project.projects_id }}";

                bootbox.confirm({
                    title: "T√∂rl√©s meger≈ës√≠t√©se",
                    message: "Biztosan t√∂r√∂lni szeretn√©d a kommentet?",
                    buttons: {
                        confirm: {
                            label: "Igen",
                            className: "btn btn-success"
                        },
                        cancel: {
                            label: "Nem",
                            className: "btn btn-danger"
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/deleteQuickComment.php", {
                                "comment_id": comment_id,
                                "projects_id": projects_id
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });

            $(".quickEditCommentButton").click(function () {
                var comment_id = $(this).data("comment-id");
                var projects_id = "{{ project.projects_id }}";

                function decodeHtmlEntities(str) {
                    var doc = new DOMParser().parseFromString(str, "text/html");
                    return doc.documentElement.textContent;
                }

                // El≈ëz≈ë komment bet√∂lt√©se AJAX-szal
                ajaxcall("projects/getComment.php", {
                    "comment_id": comment_id,
                    "projects_id": projects_id
                }, function(data) {
                    var commentText = '';
                    if (data && data.response && data.response.comment_text) {
                        console.log("Raw comment_text:", data.response.comment_text);
                        commentText = JSON.parse('"' + data.response.comment_text + '"'); // Decodes \uXXXX sequences
                        commentText = decodeHtmlEntities(commentText);
                        console.log("After JSON.parse:", commentText);
                    }                  
                    console.log("Nincs el√©rhet≈ë komment!");
                    // Megnyitjuk a bootbox dialogot
                    bootbox.dialog({
                        title: "Komment szerkeszt√©se",
                        size: 'large',
                        message: '<textarea id="editor" class="form-control">' + commentText + '</textarea>',
                        buttons: {
                            ok: {
                                label: "Ment√©s",
                                className: "btn btn-info",
                                callback: function () {
                                    let content = $('#editor').val();
                                    if (content) {
                                        ajaxcall("projects/editQuickComment.php", { // Itt m√°r editQuickComment.php a ment√©s
                                            "comment_id": comment_id,
                                            "projects_id": projects_id,
                                            "new_comment_text": content
                                        }, function (data) {
                                            location.reload();
                                        });
                                    }
                                }
                            },
                            cancel: {
                                label: "M√©gsem",
                                className: "btn btn-danger"
                            }
                        }
                    });
                });
            });


            $('#pdfGenerateModalQuote').on('show.bs.modal', function (e) {
                if ($(e.relatedTarget).data('quote') === "true") {
                    $("#pdfGenerateModalQuote .modal-title").text("√Åraj√°nlat L√©trehoz√°sa");
                    $('#pdfGenerateModalQuote input[name="quote"]').val("true");
                } 
            });
            $('#pdfGenerateModalInvoice').on('show.bs.modal', function (e) {
                if ($(e.relatedTarget).data('quote') === "false") {
                    $("#pdfGenerateModalInvoice .modal-title").text("Sz√°mla L√©trehoz√°sa");
                    $('#pdfGenerateModalInvoice input[name="quote"]').val("false");
                } 
            });
            $('#pdfGenerateModalTruck').on('show.bs.modal', function (e) {
                if ($(e.relatedTarget).data('quote') === "truck") {
                    $("#pdfGenerateModalTruck .modal-title").text("Bepakol√°si lista L√©trehoz√°sa");
                    $('#pdfGenerateModalTruck input[name="quote"]').val("truck");
                } 
            });

            $("#assetAssignmentCheckboxAll").click(function () {
                $(".assetAssignmentCheckbox").prop('checked', $(this).prop('checked'));
            });
            $(".quickAddCommentButton").click(function () {
                bootbox.dialog({
                    title: "Komment hozz√°ad√°sa",
                    size: 'large',
                    message: '<div id="editor"></div>',
                    buttons: {
                        ok: {
                            label: "Ment√©s",
                            className: "btn btn-info",
                            callback: function () {
                                let content = $('#editor').summernote('code');
                                if (content){
                                    let uniqueID = Math.floor((Date.now() + Math.random()) % 1000000000);
                                    ajaxcall("projects/newQuickComment.php", {
                                        "text": content,
                                        "projects_id": "{{ project.projects_id }}",
                                        "uniqueID": uniqueID
                                    }, function (data) {
                                        location.reload();
                                    });
                                }
                            }
                        },
                        cancel:{
                            label: "M√©gsem",
                            className: "btn btn-danger",
                        }
                    }
                });           

                $('#editor').summernote({
                    minHeight: 300,             // set minimum height of editor
                    maxHeight: null,             // set maximum height of editor
                    focus: true,
                    disableDragAndDrop: true, //We're using fineuploader for that
                    toolbar: [
                        ['oops', ['undo', 'redo']],
                        ['font', ['style', 'bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['insert', ['link','hr']],
                        ['view', ['codeview']]
                    ],
                    popover: {
                        image: [
                            ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
                            ['float', ['floatLeft', 'floatRight', 'floatNone']],
                            ['remove', ['removeMedia']]
                        ],
                        link: [
                            ['link', ['unlink']]
                        ],
                    }
                });
            });
            {% if "PROJECTS:EDIT:CLIENT"|instancePermissions %}
            $('#editProjectClient').select2({
                tags: false,
                multiple: false,
                theme: "bootstrap4",
                minimumInputLength: 0,
                width: '100%',
                minimumResultsForSearch: 1
            });
            $('#editProjectClient').on("change", function (e) {
                ajaxcall("projects/changeClient.php", {
                    "clients_id": $(this).val(),
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    location.reload();
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:PROJECT_TYPE"|instancePermissions %}
            $("#editProjectType").click(function () {
                bootbox.prompt({
                    title: "Projekt t√≠pus√°nak m√≥dos√≠t√°sa",
                    inputType: 'select',
                    value: {{ project.projectsTypes_id }},
                    inputOptions: [
                        {% for type in potentialProjectTypes %}
                        {
                            text: "{{type.projectsTypes_name|escape('js') }}",
                            value: '{{ type.projectsTypes_id }}',
                        },
                        {% endfor %}
                    ],
                    callback: function (result) {
                        if (result && result !== "{{ project.projectsTypes_id }}") {
                            ajaxcall("projects/changeProjectType.php", {
                                "projectsTypes_id": result,
                                "projects_id": "{{ project.projects_id }}"
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:LEAD"|instancePermissions %}
            $('#editProjectManager').select2({
                tags: false,
                multiple: false,
                theme: "bootstrap4",
                minimumInputLength: 0,
                width: '100%',
                minimumResultsForSearch: 1
            });
            $('#editProjectManager').on("change", function (e) {
                ajaxcall("projects/changeProjectManager.php", {
                    "users_userid": $(this).val(),
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    location.reload();
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:DESCRIPTION_AND_SUB_PROJECTS"|instancePermissions %}
            $("#editProjectDescription").click(function () {
                bootbox.prompt({
                    title: "Projekt le√≠r√°s√°nak szerkeszt√©se",
                    inputType: 'textarea',
                    value: "{{ project.projects_description|escape("js") }}",
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/changeDescription.php", {
                                "projects_description": result,
                                "projects_id": "{{ project.projects_id }}"
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:INVOICE_NOTES"|instancePermissions %}
            $(".editProjectInvoiceNotes").click(function () {
                bootbox.prompt({
                    title: "Projekt sz√°mla megjegyz√©sek szerkeszt√©se",
                    inputType: 'textarea',
                    value: `{{ project.projects_invoiceNotes|escape("js") }}`,
                    callback: function (result) {
                        if (result !== null) {  // Ha a felhaszn√°l√≥ nem nyomott "Cancel"-t
                            let finalValue = result.trim() === "" ? " " : result; // Ha √ºres, akkor sz√≥k√∂z
                            ajaxcall("projects/changeInvoiceNotes.php", {
                                "projects_invoiceNotes": finalValue,
                                "projects_id": "{{ project.projects_id }}"
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:ARCHIVE"|instancePermissions %}
            $("#archiveProject").click(function () {
                {% if project.projects_archived != 1 %}
                bootbox.confirm({
                    message: "Biztosan arch√≠v√°lni szeretn√©d a projektet?",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'Nem',
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/archive.php", {"projects_id": "{{ project.projects_id }}"}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
                {% else %}
                bootbox.confirm({
                    message: "Biztosan el szeretn√©d t√°vol√≠tani ezt a projektet az arch√≠vumb√≥l?",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'Nem',
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/unArchive.php", {"projects_id": "{{ project.projects_id }}"}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
                {% endif %}
            });
            {% endif %}
            {% if "PROJECTS:DELETE"|instancePermissions %}
            $("#deleteProject").click(function () {
                bootbox.confirm({
                    message: "Biztosan el szeretn√©d t√∂r√∂lni a projektet?",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-danger'
                        },
                        cancel: {
                            label: 'Nem',
                            className: 'btn-success'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/delete.php", {"projects_id": "{{ project.projects_id }}"}, function (data) {
                                window.location.href = "{{CONFIG.ROOTURL}}/";
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:DATES"|instancePermissions %}

            $('#buildDatePickerInput').daterangepicker({
                singleDatePicker: true,  // Csak egyetlen d√°tum v√°laszt√°sa
                timePicker: false,  // Id≈ët nem v√°lasztunk
                locale: {
                    format: 'YYYY. MM. DD.',  // A k√≠v√°nt d√°tumform√°tum
                    applyLabel: 'Alkalmaz', 
                    cancelLabel: 'M√©gsem',
                    customRangeLabel: 'Egy√©ni id≈ëszak',
                    daysOfWeek: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],
                    monthNames: ['Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius', 'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'],
                    firstDay: 1
                },
                // Kezd≈ë d√°tum be√°ll√≠t√°sa, ha van
                {% if project.projects_dates_build %}
                    {% set cleanedDate = project.projects_dates_build | date('Y. m. d.') %}
                    startDate: "{{ cleanedDate }}",  // Kezd≈ë d√°tum a projekt √©p√≠t√©si napja
                {% else %}
                autoUpdateInput: false,
                {% endif %}
            });

            $('#buildDatePickerInput').on('apply.daterangepicker', function (ev, picker) {
                var selectedDate = picker.startDate.format('YYYY. MM. DD.');
                $(this).val(selectedDate);  // Be√°ll√≠tja az input mez≈ë √©rt√©k√©t a v√°lasztott d√°tumra

                // AJAX h√≠v√°s az √©p√≠t√©si d√°tum friss√≠t√©s√©re
                ajaxcall("projects/changeBuildDates.php", {
                    "projects_dates_build": selectedDate,
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    // Ha sikeres a ment√©s, akkor k√∂zvetlen√ºl friss√≠tj√ºk a d√°tumot a frontend mez≈ëben
                    console.log("Success:", data); 
                    $('#buildDatePickerInput').val(selectedDate); // Friss√≠tj√ºk az input mez≈ët
                }, function (error) {
                    console.log('Hiba t√∂rt√©nt a ment√©s sor√°n:', error); 
                });

            });

            // Bont√°si d√°tum v√°laszt√≥
            $('#demolitionDatePickerInput').daterangepicker({
                singleDatePicker: true,  // Csak egyetlen d√°tum v√°laszt√°sa
                timePicker: false,  // Id≈ët nem v√°lasztunk
                locale: {
                    format: 'YYYY. MM. DD.',  // A k√≠v√°nt d√°tumform√°tum
                    applyLabel: 'Alkalmaz', 
                    cancelLabel: 'M√©gsem',
                    customRangeLabel: 'Egy√©ni id≈ëszak',
                    daysOfWeek: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],
                    monthNames: ['Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius', 'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'],
                    firstDay: 1
                },
                // Kezd≈ë d√°tum be√°ll√≠t√°sa, ha van
                {% if project.projects_dates_demolition %}
                    {% set cleanedDate = project.projects_dates_demolition | date('Y. m. d.') %}
                    startDate: "{{ cleanedDate }}",  // Kezd≈ë d√°tum a projekt bont√°si napja
                {% else %}
                autoUpdateInput: false,
                {% endif %}
            });

            $('#demolitionDatePickerInput').on('apply.daterangepicker', function (ev, picker) {
                var selectedDate = picker.startDate.format('YYYY. MM. DD.');
                $(this).val(selectedDate);  // Be√°ll√≠tja az input mez≈ë √©rt√©k√©t a v√°lasztott d√°tumra

                // AJAX h√≠v√°s a bont√°si d√°tum friss√≠t√©s√©re
                ajaxcall("projects/changeDemolitionDates.php", {
                    "projects_dates_demolition": selectedDate,
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    // Ha sikeres a ment√©s, akkor k√∂zvetlen√ºl friss√≠tj√ºk a d√°tumot a frontend mez≈ëben
                    console.log("Success:", data); 
                    $('#demolitionDatePickerInput').val(selectedDate); // Friss√≠tj√ºk az input mez≈ët
                }, function (error) {
                    console.log('Hiba t√∂rt√©nt a ment√©s sor√°n:', error); // Hibajelz√©s
                });
            });


            $('#datePickerInput').daterangepicker({
                timePicker: true,
                timePickerIncrement: 15,
                timePicker24Hour: true,
                locale: {
                    format: 'YYYY. MM. DD. HH:mm',
                    applyLabel: 'Alkalmaz', 
                    cancelLabel: 'M√©gsem',
                    customRangeLabel: 'Egy√©ni id≈ëszak',
                    daysOfWeek: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],
                    monthNames: ['Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius', 'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'],
                    firstDay: 1
                },
                {% if project.projects_dates_use_start %}
                startDate: "{{ project.projects_dates_use_start|date("Y. m. d. H:i") }}",
                endDate: "{{ project.projects_dates_use_end|date("Y. m. d. H:i") }}"
                {% else %}
                autoUpdateInput: false,
                {% endif %}
            });
            $('#datePickerInput').on('apply.daterangepicker', function(ev, picker) {
                ajaxcall("projects/changeProjectDates.php", {"projects_id": "{{ project.projects_id }}", "projects_dates_use_start": picker.startDate.format('YYYY. MM. DD. HH:mm'), "projects_dates_use_end": picker.endDate.format('YYYY. MM. DD. HH:mm')}, function (data) {
                    location.reload();
                });
            });


            $('.datePickerInputDeliver').each(function() {
                let startDate = $(this).data('start-date');
                let endDate = $(this).data('end-date');
                let type = $(this).data('type');

                $(this).daterangepicker({
                    timePicker: true,
                    timePickerIncrement: 15,
                    timePicker24Hour: true,
                    locale: {
                        format: 'YYYY. MM. DD. HH:mm',
                        applyLabel: 'Alkalmaz', 
                        cancelLabel: 'M√©gsem',
                        customRangeLabel: 'Egy√©ni id≈ëszak',
                        daysOfWeek: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],
                        monthNames: ['Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius', 'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'],
                        firstDay: 1
                    },
                    startDate: startDate || moment().format('YYYY. MM. DD. HH:mm'),
                    endDate: endDate || moment().add(1, 'days').format('YYYY. MM. DD. HH:mm'),
                    autoUpdateInput: !!startDate
                });
            });

            function changeProjectDeliverDates(type, start, end) {
                ajaxcall("projects/changeProjectDeliverDates.php", {
                    "type": type,
                    "projects_id": "{{ project.projects_id }}",
                    "projects_dates_deliver_start":start,
                    "projects_dates_deliver_end":end

                    }, function (data) {
                    if (data.response.changed) {
                        location.reload();
                    } else {
                        var message = "A projekt d√°tumai nem m√≥dos√≠that√≥k, mivel az ehhez rendelt eszk√∂z√∂k m√°s projektekhez is rendelve vannak, amelyek √ºtk√∂znek. <br/><br/> Szeretn√©d automatikusan elt√°vol√≠tani a k√∂vetkez≈ë eszk√∂z√∂ket a projektr≈ël? Ez sz√°ml√°z√°si k√∂vetkezm√©nyekkel j√°rhat.<br/><br/><br/><table class='table table-bordered'><tr><th>C√≠mke</th><th>N√©v</th><th>√útk√∂z≈ë Projekt</th></tr>";
                        $.each(data.response.assets, function( index, value ) {
                            message += "<tr><td>" + value['assets_tag'] + "</td><td>" + value['assetTypes_name'] + "</td><td>" + value['projects_name'] + "</td></tr>";
                        });
                        bootbox.confirm({
                            message: message + "</table>",
                            buttons: {
                                cancel: {
                                    label: 'Nem - d√°tum m√≥dos√≠t√°s√°nak visszavon√°sa',
                                    className: 'btn-success'
                                },
                                confirm: {
                                    label: 'Igen',
                                    className: 'btn-danger'
                                }
                            },
                            callback: function (result) {
                                if (result) {
                                    {% if "PROJECTS:PROJECT_ASSETS:CREATE:ASSIGN_AND_UNASSIGN"|instancePermissions %}
                                    var toRemove = [];
                                    console.log(data.response.assets);
                                    $.each(data.response.assets, function( index, value ) {
                                        toRemove.push(value['old_assetsAssignments_id']);
                                    });
                                    ajaxcall("projects/assets/unassign.php", {
                                        "assetsAssignments": toRemove
                                    }, function (data) {
                                        changeProjectDeliverDates(start, end);
                                    });
                                    {% else %}
                                    bootbox.alert("Sorry - you don't have permission to remove these assets");
                                    {% endif %}
                                }
                            }
                        });
                    }
                });
            }

            $('.datePickerInputDeliver').on('apply.daterangepicker', function(ev, picker) {
                let type = $(this).data('type'); // Az eszk√∂zcsoport t√≠pusa (pl. Technikai eszk√∂z√∂k, Sz√≠npadi eszk√∂z√∂k stb.)
                console.log("Eszk√∂zt√≠pus:", type)
                console.log("K√ºld√∂tt d√°tumok:", picker.startDate.format('YYYY-MM-DD HH:mm:ss'), picker.endDate.format('YYYY-MM-DD HH:mm:ss'));

                changeProjectDeliverDates(type, 
                    picker.startDate.format('YYYY.MM.DD. HH:mm'), 
                    picker.endDate.format('YYYY.MM.DD. HH:mm')
                );
            });

            $(document).on("click", ".copyProjectDatesToDeliverDates", function () {
                let type = $(this).data('type');
                let startDate = $("#datePickerInput").data('daterangepicker').startDate.format('YYYY.MM.DD. HH:mm');
                let endDate = $("#datePickerInput").data('daterangepicker').endDate.format('YYYY.MM.DD. HH:mm');

                changeProjectDeliverDates(type, startDate, endDate);
            });

            $(document).on("click", ".copyProjectDatesToBuildDates", function () {
                let target = $(this).data('target'); // Pl. "#buildDatePickerInput"
                let startDate = $("#datePickerInput").data('daterangepicker').startDate;
                let formattedDate = startDate.format('YYYY. MM. DD.');

                // Be√°ll√≠tjuk az input √©rt√©k√©t
                $(target).val(formattedDate);

                // AJAX h√≠v√°s az √©p√≠t√©si d√°tum friss√≠t√©s√©re
                ajaxcall("projects/changeBuildDates.php", {
                    "projects_dates_build": formattedDate,
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    console.log("Success:", data);
                    $(target).val(formattedDate); // biztos ami biztos √∫jra be√°ll√≠tjuk xd
                }, function (error) {
                    console.log('Hiba t√∂rt√©nt a ment√©s sor√°n:', error);
                });
            });
           
            function setFinanceDurationMathsHetek(weeks, days) {
                ajaxcall("projects/changeProjectFinanceDurationMaths.php", {"projects_id": "{{ project.projects_id }}","projects_dates_finances_weeks":weeks,"projects_dates_finances_days":days}, function (data) {
                    location.reload();
                });
            }
            $("#financeDurationMathsSave").click(function () {
                var days = $("#financeDurationMathsDays").val();
                var weeks = $("#financeDurationMathsHetek").val();
                setFinanceDurationMathsHetek(weeks, days);
            });
            $("#copyProjectDatesToFinanceDurationMaths").click(function () {
                setFinanceDurationMathsHetek("-1", "-1");
            });

            {% endif %}
            {% if "PROJECTS:EDIT:NAME"|instancePermissions %}
            $("#editProjectName").click(function () {
                bootbox.prompt({
                    title: "Projekt n√©v m√≥dos√≠t√°sa",
                    inputType: 'text',
                    value: `{{ project.projects_name|escape("js") }}`,
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/changeName.php", {
                                "projects_name": result,
                                "projects_id": "{{ project.projects_id }}"
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:STATUS"|instancePermissions %}
            function changeStatus(newStatus) {
                ajaxcall("projects/changeStatus.php", {
                    "projectsStatuses_id": newStatus,
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    if (data.response.changed) {
                        location.reload();
                    } else {
                        var message = "A projekt st√°tusza nem m√≥dos√≠that√≥, mert a hozz√°rendelt eszk√∂z√∂k m√°s projektekhez is hozz√°rendel√©sre ker√ºltek, amelyek √ºtk√∂znek. <br/><br/> Szeretn√© automatikusan elt√°vol√≠tani a k√∂vetkez≈ë eszk√∂z√∂ket ebb≈ël a projekb≈ël? Ez sz√°ml√°z√°si k√∂vetkezm√©nyekkel j√°r. <br/><br/><br/><table class='table table-bordered'><tr><th>C√≠mke</th><th>N√©v</th><th>√útk√∂z≈ë Projekt</th></tr>";
                        $.each(data.response.assets, function( index, value ) {
                            message += "<tr><td>" + value['assets_tag'] + "</td><td>" + value['assetTypes_name'] + "</td><td>" + value['projects_name'] + "</td></tr>";
                        });
                        bootbox.confirm({
                            message: message + "</table>",
                            buttons: {
                                cancel: {
                                    label: 'Nem',
                                    className: 'btn-success'
                                },
                                confirm: {
                                    label: 'Igen',
                                    className: 'btn-danger'
                                }
                            },
                            callback: function (result) {
                                if (result) {
                                    {% if "PROJECTS:PROJECT_ASSETS:CREATE:ASSIGN_AND_UNASSIGN"|instancePermissions %}
                                    var toRemove = [];
                                    console.log(data.response.assets);
                                    $.each(data.response.assets, function( index, value ) {
                                        toRemove.push(value['old_assetsAssignments_id']);
                                    });
                                    ajaxcall("projects/assets/unassign.php", {
                                        "assetsAssignments": toRemove
                                        }, function (data) {
                                            changeStatus(newStatus);
                                        });
                                    {% else %}
                                    bootbox.alert("Eln√©z√©st, nincs enged√©lye ezeknek az eszk√∂z√∂knek az elt√°vol√≠t√°s√°ra.");
                                    {% endif %}
                                }
                            }
                        });
                    }
                });
            }
            $("#editProjectStatus").click(function () {
                bootbox.prompt({
                    title: "√Åll√≠tsa be a projekt st√°tusz√°t",
                    inputType: 'select',
                    value: {{ project.projectsStatuses_id }},
                    inputOptions: [
                        {% set STATUSESAVAILABLE = [] %}
                        {% for STATUS in POSSIBLEPROJECTSTATUSES %}
                            {
                                text: "{{ STATUS.projectsStatuses_name }}{% if STATUS.projectsStatuses_description != '' %} ({{ STATUS.projectsStatuses_description }}){% endif %}",
                                value: '{{ STATUS.projectsStatuses_id }}',
                            },
                            {% if STATUS.projectsStatuses_assetsReleased == 1 %}
                                {% set STATUSESAVAILABLE = STATUSESAVAILABLE|merge([STATUS.projectsStatuses_id]) %}
                            {% endif %}
                        {% endfor %}
                    ],
                    callback: function (result) {
                        if (result) {
                            var newStatus = result;                            
                            if ([{{ STATUSESAVAILABLE|join(",") }}].includes(parseInt(newStatus))) {
                                bootbox.confirm({
                                    message: "Ez lehet≈ëv√© teszi, hogy az ehhez a projekthez rendelt eszk√∂z√∂k m√°s √ºtk√∂z≈ë projektekhez legyenek rendelve - biztosan folytatni szeretn√©?",
                                    buttons: {
                                        confirm: {
                                            label: 'Igen',
                                            className: 'btn-danger'
                                        },
                                        cancel: {
                                            label: 'Nem',
                                            className: 'btn-success'
                                        }
                                    },
                                    callback: function (result) {
                                        if (result) {
                                            changeStatus(newStatus);
                                        }
                                    }
                                });
                            } else {
                                changeStatus(newStatus);
                            }
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:EDIT:ADDRESS"|instancePermissions %}
            $('#editProjectAddress').select2({
                tags: false,
                multiple: false,
                theme: "bootstrap4",
                minimumInputLength: 0,
                width: '100%',
                minimumResultsForSearch: 1,
                templateResult: function (input) {
                    if (!input.id || !input.title) {
                        return input.text;
                    }
                    var $result = $(
                        '<span><b>' + input.title + ' </b>' + input.text + '</span>'
                    );
                    return $result;
                }
            });
            $('#editProjectAddress').on("change", function (e) {
                ajaxcall("projects/changeVenue.php", {
                    "locations_id": $(this).val(),
                    "projects_id": "{{ project.projects_id }}"
                }, function (data) {
                    location.reload();
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_ASSETS:CREATE:ASSIGN_ALL_BUSINESS_ASSETS"|instancePermissions %}
            $("#addAllAssetsToProject").click(function () {
                bootbox.confirm({
                    message: "Biztosan hozz√° szeretn√© adni az √∂sszes, a v√°llalkoz√°sban el√©rhet≈ë eszk√∂zt a projekthez?",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-success'
                        },
                        cancel: {
                            label: 'M√©gsem',
                            className: 'btn-default'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/assets/assign.php", {"projects_id": "{{ project.projects_id }}"}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_PAYMENTS:CREATE"|instancePermissions %}
            $('#newPaymentModal-form-date').daterangepicker({
                timePicker: true,
                timePickerIncrement: 1,
                singleDatePicker: true,
                timePicker24Hour: true,
                locale: {
                    format: 'YYYY. MM. DD. HH:mm',
                    applyLabel: 'Alkalmaz', 
                    cancelLabel: 'M√©gsem',
                    customRangeLabel: 'Egy√©ni id≈ëszak',
                    daysOfWeek: ['V', 'H', 'K', 'Sze', 'Cs', 'P', 'Szo'],
                    monthNames: ['Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius', 'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'],
                    firstDay: 1
                },
                startDate: "{{ 'now'|date('Y. m. d. H:i') }}",
                maxDate: "{{ 'now'|date('Y. m. d. H:i') }}",
            });
            $(".newPayment").click(function () {
                var type = $(this).data("type");
                $("#newPaymentModal-form-type").val(type);
                $("#newPaymentModal").modal('show');
                $(".newPaymentModal-paymentOnly").hide();
                $(".newPaymentModal-paymentHour").hide();                
                $(".newPaymentModal-nonPaymentOnly").show();
                $(".newPaymentModal-paymentSimple").show();
                
                switch(type) {
                    case 1:
                        $("#newPaymentModal-title").html("Kifizet√©s hozz√°ad√°sa");
                        $(".newPaymentModal-paymentOnly").show();
                        $(".newPaymentModal-nonPaymentOnly").hide();
                        $(".newPaymentModal-nonPaymentOnly textarea[name='payments_comment']").closest('.input-group').show(); // Megjegyz√©s (Le√≠r√°s) megjelen√≠t√©se
                        $(".newPaymentModal-nonPaymentOnly input[name='payments_amount']").closest('.input-group').show(); // √ñsszeg megjelen√≠t√©se
                        $(".newPaymentModal-paymentSimple input[name='payments_supplier']").closest('.input-group').hide(); // Sz√°ll√≠t√≥ elrejt√©se

                        break;
                    case 2:
                        $("#newPaymentModal-title").html("√ârt√©kes√≠t√©si t√©tel hozz√°ad√°sa");
                        $(".newPaymentModal-paymentSimple").hide();
                        break;
                    case 3:
                        $("#newPaymentModal-title").html("Tov√°bbi b√©rleti k√∂lts√©g hozz√°ad√°sa");
                        $(".newPaymentModal-paymentSimple").hide();
                        break;
                    case 4:
                        $("#newPaymentModal-title").html("Szimpla munkav√°llal√≥i k√∂lts√©g hozz√°ad√°sa");
                        $(".newPaymentModal-paymentSimple").hide();
                        break;
                    case 5:
                        $("#newPaymentModal-title").html("√ìrab√©r alap√∫ munkav√°llal√≥i k√∂lts√©g hozz√°ad√°sa");
                        $(".newPaymentModal-nonPaymentOnly").hide();
                        $(".newPaymentModal-paymentHour").show();
                        $(".newPaymentModal-paymentSimple input[name='payments_supplier']").closest('.input-group').hide(); // Sz√°ll√≠t√≥ elrejt√©se
                        break;
                    case 6:
                        $("#newPaymentModal-title").html("Sz√°ll√≠t√°si k√∂lts√©g hozz√°ad√°sa");
                        $(".newPaymentModal-paymentSimple").hide();
                        break;
                }
            });
            $("#newPaymentModal-button").click(function () {
                var formData = $("#newPaymentModal-form").serializeArray();
                console.log($("input[name='payments_quantity']").val());

                ajaxcall("projects/newPayment.php", {formData}, function (data) {
                    location.reload();
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_PAYMENTS:DELETE"|instancePermissions %}
            $(".deletePaymentButton").click(function () {
                var id = $(this).data("paymentid");
                bootbox.confirm({
                    message: "Biztosan t√∂r√∂lni szeretn√© ezt a kifizet√©st?",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-success'
                        },
                        cancel: {
                            label: 'M√©gsem',
                            className: 'btn-default'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/deletePayment.php", {"payments_id": id}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_NOTES:EDIT:NOTES"|instancePermissions %}
            $('.summernote').summernote({
                minHeight: 500,             // set minimum height of editor
                maxHeight: null,             // set maximum height of editor
                focus: true,
                disableDragAndDrop: true, //We're using fineuploader for that
                placeholder: 'Your epic note goes here',
                toolbar: [
                    ['oops', ['undo', 'redo']],
                    ['font', ['style', 'bold', 'italic', 'underline', 'strikethrough', 'superscript', 'subscript', 'clear']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['hr']]
                ],
                popover: {
                    image: [
                        ['imagesize', ['imageSize100', 'imageSize50', 'imageSize25']],
                        ['float', ['floatLeft', 'floatRight', 'floatNone']],
                        ['remove', ['removeMedia']]
                    ],
                    link: [
                        ['link', ['unlink']]
                    ],
                    table: [
                        ['add', ['addRowDown', 'addRowUp', 'addColLeft', 'addColRight']],
                        ['delete', ['deleteRow', 'deleteCol', 'deleteTable']],
                    ]
                }
            });
            $(".noteModal-save").click(function () {
                var callback = $(this).data("callback");
                var noteid = $(this).data("noteid")
                ajaxcall("projects/editNote.php", {"projects_id": "{{ project.projects_id }}", "projectsNotes_id": noteid, "projectsNotes_text":$('.summernote[data-noteid=' + noteid + ']').summernote('code')}, function (data) {
                    if (callback == "print") {
                        window.location.href = "{{ CONFIG.ROOTURL }}/project/noteExport.php?id=" + noteid;
                    } else {
                        location.reload();
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_NOTES:CREATE:NOTES"|instancePermissions %}
            $("#newProjectNote").click(function () {
                bootbox.prompt({
                    title: "Megjegyz√©s c√≠me",
                    inputType: 'text',
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/newNote.php", {
                                "projectsNotes_title": result,
                                "projects_id": "{{ project.projects_id }}"
                            }, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_CREW:EDIT"|instancePermissions %}
            $(".editCrewAssignment").click(function () {
                var id = $(this).data("assignment");
                var role = $(this).data("role");
                bootbox.prompt({
                    title: "Beoszt√°s n√©v szerkeszt√©se",
                    value: role,
                    callback: function (roleResult) {
                        if (roleResult && roleResult != null) {
                            ajaxcall("projects/crew/edit.php", {"crewAssignments_id": id, "crewAssignments_role": roleResult}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            $(".editCrewAssignmentComment").click(function () {
                var id = $(this).data("assignment");
                var comment = $(this).data("comment");
                bootbox.prompt({
                    title: "Beoszt√°s megjegyz√©s szerkeszt√©se", 
                    value: comment,
                    callback: function (commentResult) {
                        console.log(commentResult);
                        ajaxcall("projects/crew/edit.php", {"crewAssignments_id": id, "crewAssignments_comment": commentResult}, function (data) {
                            location.reload();
                        });
                    }
                });
            });
            $(".deleteCrewAssignment").click(function () {
                var id = $(this).data("assignment");
                bootbox.confirm({
                    message: "Biztosan el szeretn√©d t√°vol√≠tani ezt a munkat√°rsat? ≈ê √©rtes√≠t√©st fog kapni.",
                    buttons: {
                        confirm: {
                            label: 'Igen',
                            className: 'btn-success'
                        },
                        cancel: {
                            label: 'M√©gsem',
                            className: 'btn-default'
                        }
                    },
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/crew/unassign.php", {"crewAssignments_id": id}, function (data) {
                                location.reload();
                            });
                        }
                    }
                });
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_CREW:CREATE"|instancePermissions %}
            $("#addCrewModal-users").select2({
                tags: true,
                tokenSeparators: [','],
                templateSelection: function(selection) {
                    if (selection.email) {
                        return $.parseHTML(selection.text + (selection.clashes.length > 0 ? ' [CLASHES]' : '') + '</span>');
                    } else {
                        return $.parseHTML('<span style="color:#ff9100;">Name: ' + selection.text + '</span>');
                    }
                },
                templateResult: function(selection) {
                    if (selection.email) {
                        return $.parseHTML(selection.text + ' (' + selection.email + ') ' + (selection.clashes.length > 0 ? '<span class="badge badge-danger">Clash with ' + selection.clashes + '</span>' : ''));
                    } else {
                        return "Add name: " + selection.text;
                    }
                },
                multiple: true,
                theme: "bootstrap4",
                minimumInputLength: 0,
                width: '100%',
                placeholder: "Search for existing {{ CONFIG.PROJECT_NAME }} users to add to crew",
                ajax: {
                    url: "{{ CONFIG.ROOTURL }}/api/projects/crew/searchUser.php",
                    dataType: "json",
                    type: "POST",
                    data: function (params) {
                        var queryParameters = {
                            term: params.term,
                            projects_id: "{{ project.projects_id }}"
                        }
                        return queryParameters;
                    },
                    processResults: function (data) {
                        if (data && data.result && data.response) {
                            return {
                                results: $.map(data.response, function (item) {
                                    return {
                                        text: item.users_name1 + " " + item.users_name2,
                                        email: item.users_email,
                                        id: item.users_userid,
                                        clashes: item.clashes.join(",")
                                    }
                                })
                            };
                        } else return {
                            results: []
                        };
                    }
                }
            });
            $('#addCrewModal-button').on('click', function(e){
                if ($("#addCrewModal-users").select2("val").length > 0) {
                    if($("#addCrewModal-form")[0].checkValidity() === false) {
                        return true;
                    }
                    var formData = $("#addCrewModal-form").serializeArray();
                    ajaxcall("projects/crew/assign.php", {
                        formData,
                        "users": $("#addCrewModal-users").select2("val")
                    }, function () {
                        location.reload();
                    }, true);
                }
            });
            {% endif %}
            {% if "PROJECTS:PROJECT_CREW:EDIT:CREW_RANKS"|instancePermissions %}
            $('#crewList').sortable({
                placeholder         : 'sort-highlight',
                handle              : '.handle',
                forcePlaceholderSize: true,
                zIndex              : 999999,
                update: function( event, ui ) {
                    ajaxcall("projects/crew/sortRank.php", {
                        "order": $("#crewList").sortable('toArray', {attribute: 'value'}),
                        "projects_id": "{{ project.projects_id }}"
                    }, null, true);

                }
            });
            {% endif %}
            {% if "PROJECTS:CREATE"|instancePermissions %}
            $("#newSubProject").click(function () {
                bootbox.prompt({
                    title: "V√°laszd ki az Al-Projekt T√≠pus√°t",
                    inputType: 'select',
                    inputOptions: [
                        {% for type in potentialProjectTypes %}
                        {
                            text: '{{type.projectsTypes_name|escape('js')}}',
                            value: '{{ type.projectsTypes_id }}',
                        },
                        {% endfor %}
                    ],
                    callback: function (result){
                        if (result) {
                            var projectType = result;
                            bootbox.prompt("Add meg az Al-Projekt Nevet", function (result) {
                                if (result) {
                                    ajaxcall("projects/new.php", {
                                        "projects_name": result,
                                        "projectsType_id": projectType,
                                        "projects_manager": "{{ project.projects_manager }}",
                                        "projects_parent_project_id": "{{ project.projects_id }}",
                                    }, function (data) {
                                        window.location.href = "{{ CONFIG.ROOTURL }}/project/?id=" + data.response['projects_id'];
                                    });
                                }
                            });
                        }
                    }
                })
            });

            $("#assignParentProject").click(function () {
                bootbox.prompt({
                    title: "V√°lassza ki a Sz√ºl≈ë Projektet",
                    inputType: 'select',
                    value: "{{ (project.projects_parent_project_id ?: '-1') }}",
                    inputOptions: [
                        {
                            text: 'Nincs Sz√ºl≈ë',
                            value: -1,
                        },
                        {% for allProject in projects %}
                            {% if allProject.projects_id != project.projects_id %}
                                {
                                    text: '{{ allProject.projects_name|escape("js") }}',
                                    value: '{{ allProject.projects_id }}',
                                },
                            {% endif %}
                        {% endfor %}
                    ],
                    callback: function (result) {
                        if (result) {
                            ajaxcall("projects/changeSubProject.php", {
                                "projects_id": "{{ project.projects_id }}",
                                "projects_parent_project_id": result,
                            }, function (data) {
                                window.location.reload();
                            });
                        }
                    }
                })
            });

            $("#followParent").click(function () {
                ajaxcall("projects/followParentStatus.php", {
                    "projects_id": "{{ project.projects_id }}",
                    "follow": "true",
                }, function (data) {
                    window.location.reload();
                });
            });
            $("#stopFollowParent").click(function () {
                ajaxcall("projects/followParentStatus.php", {
                    "projects_id": "{{ project.projects_id }}",
                    "follow": "false",
                }, function (data) {
                    window.location.reload();
                });
            });
            {% endif %}

            // Show initial Tab
            var hash = location.hash.replace(/^#/, '');
            if (hash) {
                $('#nav-bar .nav-item a[href="#' + hash + '"]').tab('show');
            }

            // Change hashtag on tab change for page-reload
            $('#nav-bar .nav-item a').on('shown.bs.tab', function (e) {
                window.location.hash = e.target.hash;
                document.body.scrollTop = 0; // For Safari
                document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
            })
        });
    </script>
{% embed 'assets/templates/fileBoxJS.twig' %}

    {% endembed %}
{% endblock %}